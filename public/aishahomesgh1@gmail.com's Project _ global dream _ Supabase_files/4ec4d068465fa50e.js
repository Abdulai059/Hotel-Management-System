;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="fca9db0f-0664-fa92-7af7-bf1906685481")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,561912,e=>{"use strict";var t=e.i(478902),n=e.i(389959);e.i(128328);var r=e.i(158639),a=e.i(934302),s=e.i(645388),i=e.i(346428),l=e.i(201844),o=e.i(356003),c=e.i(962217),d=e.i(70756),u=e.i(635494),p=e.i(681328),h=e.i(595519),m=e.i(276423),x=e.i(971131),f=e.i(201461),g=e.i(636047),b=e.i(70255),y=e.i(463333);function j(e,t){return e.indexOf(t)>=0}function v({gridRef:e,rows:t}){let r=(0,b.useTableEditorTableStateSnapshot)(),a=(0,n.useMemo)(()=>"windows"==(navigator?.appVersion.indexOf("Win")!==-1?"windows":navigator?.appVersion.indexOf("Mac")!==-1?"macos":"unknown")?"Control":"Command",[]);return!function(e,t=[],r=[]){let[a,s]=n.useState(),i=n=>{var a;if(!e||j(t,n.target.nodeName)||j(r,n.target.className))return;let i=(a=n).metaKey&&a.shiftKey?`Command+Shift+${a.key}`:a.metaKey?`Command+${a.key}`:a.shiftKey&&"Enter"===a.key?`Shift+${a.key}`:a.ctrlKey&&a.key?`Control+${a.key}`:a.key;e[i]&&(i.includes("+")?(n.preventDefault(),e[i](n),s(null)):(s(n.key),n.preventDefault()))},l=t=>{e&&e[t.key]&&a===t.key&&(t.preventDefault(),e[t.key](t),s(null))};n.useEffect(()=>(window.addEventListener("keydown",i),window.addEventListener("keyup",l),()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",l)}))}({[`${a}+ArrowUp`]:t=>{if(t.stopPropagation(),r.selectedCellPosition){let t={idx:r.selectedCellPosition?.idx??0,rowIdx:0};e.current.selectCell(t)}else e.current.scrollToCell({rowIdx:Number(0)})},[`${a}+ArrowDown`]:n=>{if(n.stopPropagation(),r.selectedCellPosition){let n={idx:r.selectedCellPosition?.idx??0,rowIdx:t.length>1?t.length-1:0};e.current.selectCell(n)}else e.current.scrollToCell({rowIdx:Number(t.length)})},[`${a}+ArrowLeft`]:t=>{t.stopPropagation();let n={idx:r.gridColumns.filter(e=>e.frozen).length,rowIdx:r.selectedCellPosition?.rowIdx??0};e.current.selectCell(n)},[`${a}+ArrowRight`]:t=>{t.stopPropagation(),e.current?.selectCell({idx:r.gridColumns.length-2,rowIdx:r.selectedCellPosition?.rowIdx??0})}},["INPUT","TEXTAREA","SELECT"]),null}var w=e.i(645974),S=e.i(805303),C=e.i(425861),N=e.i(415190),T=e.i(899850),k=e.i(3036),R=e.i(710377),E=e.i(382490),D=e.i(774803),_=e.i(632459),P=e.i(821276),I=e.i(437893),A=e.i(837710),L=e.i(613580),O=e.i(746301),M=e.i(466472),F=e.i(205311),$=e.i(526925);let Q=[{value:100,label:"100 rows"},{value:500,label:"500 rows"},{value:1e3,label:"1000 rows"}],B=({onRowsPerPageChange:e})=>{let n=(0,g.useTableEditorStateSnapshot)();return(0,t.jsx)(F.DropdownControl,{options:Q,onSelect:e,side:"top",align:"start",children:(0,t.jsx)(A.Button,{asChild:!0,type:"outline",style:{padding:"3px 10px"},children:(0,t.jsx)("span",{children:`${n.rowsPerPage} rows`})})})},z=({enableForeignRowsQuery:e=!0})=>{let{id:a}=(0,r.useParams)(),s=a?Number(a):void 0,{sorts:i}=(0,P.useTableSort)(),{filters:o}=(0,_.useTableFilter)(),{data:p}=(0,u.useSelectedProjectQuery)(),h=(0,g.useTableEditorStateSnapshot)(),m=(0,b.useTableEditorTableStateSnapshot)(),x=(0,f.useRoleImpersonationStateSnapshot)(),{data:y}=(0,N.useTableEditorQuery)({projectRef:p?.ref,connectionString:p?.connectionString,id:s}),j=(0,c.isForeignTable)(y),v=m.page,w=(0,c.isTable)(y)?y.live_rows_estimate:null,[S,C]=(0,n.useState)(v.toString()),[F,Q]=(0,n.useState)(!1),[z,q]=(0,n.useState)(!1),[U,V]=(0,n.useState)(!1),{data:W,isPending:H,isSuccess:K,isError:G,isFetching:Y,error:J}=(0,I.useTableRowsCountQuery)({projectRef:p?.ref,connectionString:p?.connectionString,tableId:m.table.id,filters:o,enforceExactCount:m.enforceExactCount,roleImpersonationState:x},{placeholderData:l.keepPreviousData,enabled:!j}),X=W?.count??0,Z=W?.is_estimate?(0,$.formatEstimatedCount)(X):X.toLocaleString(),ee=Math.ceil(X/h.rowsPerPage),et=X>0?ee:1,{data:en,isPending:er}=(0,d.useTableRowsQuery)({projectRef:p?.ref,connectionString:p?.connectionString,tableId:s,sorts:i,filters:o,page:m.page,limit:h.rowsPerPage,roleImpersonationState:x},{enabled:j&&e}),ea=(en?.rows??[]).length<h.rowsPerPage,es=()=>{v>1&&(m.selectedRows.size>=1?q(!0):ei())},ei=()=>{let e=v-1;m.setPage(e)},el=()=>{let e=v+1;m.setPage(e)},eo=e=>{let t=e>ee?ee:e;m.setPage(t||1)},ec=e=>{let t=Number(e);h.setRowsPerPage(isNaN(t)?100:t)};return((0,n.useEffect)(()=>{C(String(v))},[v]),(0,n.useEffect)(()=>{!j&&v&&v>et&&m.setPage(et)},[j,v,et]),(0,n.useEffect)(()=>{void 0!==s&&m.setEnforceExactCount(null!==w&&w<=T.THRESHOLD_COUNT)},[s]),(0,n.useEffect)(()=>{G&&m.enforceExactCount&&J?.code===408&&m.setEnforceExactCount(!1)},[G,m.enforceExactCount,J?.code]),j)?(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(A.Button,{"aria-label":"Previous page",icon:(0,t.jsx)(k.ArrowLeft,{}),type:"outline",className:"px-1.5",disabled:v<=1,onClick:es}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Page"}),(0,t.jsx)(O.Input,{size:"tiny",className:"w-10",min:1,value:S,onChange:e=>C(e.target.value),onKeyDown:e=>{let t=Number(S);("Enter"===e.code||"NumpadEnter"===e.code)&&!Number.isNaN(t)&&t>=1&&eo(t)}}),(0,t.jsx)(A.Button,{"aria-label":"Next page",icon:(0,t.jsx)(R.ArrowRight,{}),type:"outline",className:"px-1.5",disabled:ea||!e,loading:er&&e,onClick:el}),(0,t.jsx)(B,{onRowsPerPageChange:ec})]}):(0,t.jsxs)("div",{className:"flex items-center gap-x-4",children:[H&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(D.Loader2,{size:12,className:"animate-spin"}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Loading records count..."})]}),K&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(A.Button,{"aria-label":"Previous page",icon:(0,t.jsx)(k.ArrowLeft,{}),type:"outline",className:"px-1.5",disabled:v<=1||H,onClick:es}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Page"}),(0,t.jsx)(O.Input,{className:"w-12",size:"tiny",min:1,max:ee,value:S,onChange:e=>C(e.target.value),onKeyDown:e=>{let t=Number(S);("Enter"===e.code||"NumpadEnter"===e.code)&&!Number.isNaN(t)&&t>=1&&t<=ee&&eo(t)}}),(0,t.jsxs)("p",{className:"text-xs text-foreground-light",children:["of ",et.toLocaleString()]}),(0,t.jsx)(A.Button,{"aria-label":"Next page",icon:(0,t.jsx)(R.ArrowRight,{}),type:"outline",className:"px-1.5",disabled:v>=ee||H,onClick:()=>{v<ee&&(m.selectedRows.size>=1?Q(!0):el())}}),(0,t.jsx)(B,{onRowsPerPageChange:ec})]}),!j&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsxs)("p",{className:"text-xs text-foreground-light",children:[`${Z} ${0===X||X>1?"records":"record"}`," ",W.is_estimate?"(estimated)":""]}),W.is_estimate&&(0,t.jsxs)(L.Tooltip,{children:[(0,t.jsx)(L.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(A.Button,{size:"tiny",type:"text",className:"px-1.5",loading:Y,icon:(0,t.jsx)(E.HelpCircle,{}),onClick:()=>{null===w||X>T.THRESHOLD_COUNT?V(!0):m.setEnforceExactCount(!0)}})}),(0,t.jsxs)(L.TooltipContent,{side:"top",className:"w-72",children:["This is an estimated value as your table has more than"," ",T.THRESHOLD_COUNT.toLocaleString()," rows. ",(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"text-brand",children:"Click to retrieve the exact count of the table."})]})]})]})]}),G&&(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Error fetching records count. Please refresh the page."}),(0,t.jsx)(M.default,{visible:z,title:"Confirm moving to previous page",confirmLabel:"Confirm",onCancel:()=>q(!1),onConfirm:()=>{ei(),q(!1)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,t.jsx)(M.default,{visible:F,title:"Confirm moving to next page",confirmLabel:"Confirm",onCancel:()=>Q(!1),onConfirm:()=>{el(),Q(!1)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,t.jsx)(M.default,{variant:"warning",visible:U,title:"Confirm to fetch exact count for table",confirmLabel:"Retrieve exact count",onCancel:()=>V(!1),onConfirm:()=>{m.setEnforceExactCount(!0),V(!1)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:null===w?`If your table has a row count of greater than ${T.THRESHOLD_COUNT.toLocaleString()} rows,
          retrieving the exact count of the table may cause performance issues on your database.`:`Your table has a row count of greater than ${T.THRESHOLD_COUNT.toLocaleString()} rows, and
          retrieving the exact count of the table may cause performance issues on your database.`})})]})},q=({enableForeignRowsQuery:e=!0})=>{let{id:n}=(0,r.useParams)(),a=n?Number(n):void 0,{data:s}=(0,u.useSelectedProjectQuery)(),[i,l]=(0,w.useQueryState)("view",w.parseAsString.withDefault("data")),{data:o}=(0,N.useTableEditorQuery)({projectRef:s?.ref,connectionString:s?.connectionString,id:a}),d=(0,c.isViewLike)(o),p=(0,c.isTableLike)(o);return(0,t.jsxs)(S.GridFooter,{children:["data"===i&&(0,t.jsx)(z,{enableForeignRowsQuery:e}),(0,t.jsx)("div",{className:"ml-auto flex items-center gap-x-2",children:(d||p)&&(0,t.jsx)(C.default,{width:75,options:["definition","data"],activeOption:i,borderOverride:"border",onClickOption:l})})]})};function U(){let e=(0,b.useTableEditorTableStateSnapshot)();return{filters:e.filters,setFilters:t=>e.setFilters(t),clearFilters:()=>e.clearFilters()}}var V=e.i(19583),W=e.i(687256),H=e.i(471994),K=e.i(311827),G=e.i(162082),Y=e.i(265735),J=e.i(323150),X=e.i(591385),Z=e.i(843778),ee=e.i(108151),et=e.i(991435);e.i(505572);var en=e.i(859791),er=e.i(623705),ea=e.i(328675),es=e.i(513826),ei=e.i(790819),el=e.i(478145),eo=e.i(10429),ec=e.i(355901),ed=e.i(567558),eu=e.i(937942),ep=e.i(710483),eh=e.i(253214);let em=({error:e,suggestions:n})=>(0,t.jsx)(ep.Admonition,{type:"default",title:"Data not loaded to protect database performance",description:"The query to retrieve the data was not run as it could place heavy load on the database and impact performance",children:(0,t.jsx)(ex,{error:e,suggestions:n})}),ex=({error:e,suggestions:n=[]})=>{let r=e.metadata;return(0,t.jsxs)(eh.Dialog,{children:[(0,t.jsx)(eh.DialogTrigger,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"default",className:"mt-2",children:"Learn more"})}),(0,t.jsxs)(eh.DialogContent,{onOpenAutoFocus:e=>e.preventDefault(),children:[(0,t.jsxs)(eh.DialogHeader,{children:[(0,t.jsx)(eh.DialogTitle,{children:"Estimated query cost exceeds safety thresholds"}),(0,t.jsx)(eh.DialogDescription,{children:"Preventive measure to mitigate impacting the database"})]}),(0,t.jsx)(eh.DialogSectionSeparator,{}),(0,t.jsxs)(eh.DialogSection,{className:"flex flex-col gap-y-2 text-sm",children:[(0,t.jsx)("p",{children:"The dashboard runs optimized SQL queries on your projectâ€™s database to load data for this interface."}),(0,t.jsxs)("p",{children:["However, the query was skipped as its"," ",(0,t.jsxs)(L.Tooltip,{children:[(0,t.jsx)(L.TooltipTrigger,{className:eu.InlineLinkClassName,children:"estimated cost"}),(0,t.jsxs)(L.TooltipContent,{side:"bottom",className:"flex flex-col gap-y-1",children:[(0,t.jsxs)("p",{children:["Estimated cost: ",r?.cost.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-foreground-light",children:["Determined via the ",(0,t.jsx)("code",{className:"text-code-inline",children:"EXPLAIN"})," command"]})]})]})," ","is high and could place significant load on the database."]}),n.length>0&&(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("p",{children:"You may check the following to ensure that the query cost is lower"}),(0,t.jsx)("ul",{className:"list-disc pl-6",children:n.map(e=>(0,t.jsx)("li",{children:e},e))})]})]}),(0,t.jsxs)(eh.DialogFooter,{children:[(0,t.jsx)(es.DocsButton,{href:`${eo.DOCS_URL}/guides/troubleshooting/understanding-postgresql-explain-output-Un9dqX`}),(0,t.jsx)(eh.DialogClose,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"default",className:"opacity-100",children:"Understood"})})]})]})]})};var ef=e.i(714403);let eg=({error:e})=>{let{filters:n}=(0,_.useTableFilter)(),{sorts:r}=(0,P.useTableSort)(),a=(0,b.useTableEditorTableStateSnapshot)();if(!e)return null;let s=a.originalTable?.entity_type===K.ENTITY_TYPE.FOREIGN_TABLE&&e?.message?.includes("query vault failed"),i=n.length>0&&e?.message?.includes("invalid input syntax"),l=r.length>0&&e?.message?.includes("identify an ordering operator");return e?.message.includes(ef.COST_THRESHOLD_ERROR)?(0,t.jsx)(em,{error:e,suggestions:["Remove any sorts or filters on unindexed columns, or","Create indexes for columns that you want to filter or sort on"]}):s?(0,t.jsx)(eb,{}):i?(0,t.jsx)(ey,{error:e}):l?(0,t.jsx)(ej,{error:e}):(0,t.jsx)(ev,{error:e})},eb=()=>{let{ref:e}=(0,r.useParams)(),{data:n}=(0,u.useSelectedProjectQuery)(),a=n?.parent_project_ref!==void 0;return(0,t.jsxs)(ep.Admonition,{type:"warning",className:"pointer-events-auto",title:"Failed to retrieve rows from foreign table",children:[(0,t.jsxs)("p",{children:["The key that's used to retrieve data from your foreign table is either incorrect or missing. Verify the key in your"," ",(0,t.jsx)(eu.InlineLink,{href:`/project/${e}/integrations?category=wrapper`,children:"wrapper's settings"})," ","or in ",(0,t.jsx)(eu.InlineLink,{href:`/project/${e}/integrations/vault/overview`,children:"Vault"}),"."]}),a&&(0,t.jsxs)("p",{children:["Note: Vault keys from the main project do not sync to branches. You may add them manually into ",(0,t.jsx)(eu.InlineLink,{href:`/project/${e}/integrations/vault/overview`,children:"Vault"})," ","if you want to query foreign tables while on a branch."]})]})},ey=({error:e})=>{let{onApplyFilters:n}=(0,_.useTableFilter)();return(0,t.jsxs)(ep.Admonition,{type:"warning",className:"pointer-events-auto",title:"Invalid input syntax provided in filter value(s)",children:[(0,t.jsx)("p",{className:"!mb-0",children:"Unable to retrieve results as the provided value in your filter(s) doesn't match it's column data type."}),(0,t.jsx)("p",{className:"!mb-2",children:"Verify that your filter values are correct before applying the filters again."}),(0,t.jsxs)("p",{className:"text-sm text-foreground-lighter prose max-w-full !mb-4",children:["Error: ",(0,t.jsx)("code",{className:"text-code-inline",children:e.message})]}),(0,t.jsx)(A.Button,{type:"default",onClick:()=>n([]),children:"Remove filters"})]})},ej=({error:e})=>{let{sorts:n,onApplySorts:r}=(0,P.useTableSort)(),a=(e.message??"").split("type ").pop()??"",s=a.includes("json")?a.toUpperCase():a;return(0,t.jsxs)(ep.Admonition,{type:"warning",className:"pointer-events-auto",title:`Sorting is not supporting on ${n.length>1?"one of the selected columns":"the selected column"}`,children:[(0,t.jsxs)("p",{className:"!mb-0",children:["Unable to retrieve results as sorting is not supported on"," ",n.length>1?"one of the selected columns":"the selected column"," due to its data type. (",s,")"]}),(0,t.jsxs)("p",{className:"!mb-2",children:["Remove any sorts on columns with the data type ",s," applying the sorts again."]}),(0,t.jsxs)("p",{className:"text-sm text-foreground-lighter prose max-w-full !mb-4",children:["Error: ",(0,t.jsx)("code",{className:"text-code-inline",children:e.message})]}),(0,t.jsx)(A.Button,{type:"default",onClick:()=>r([]),children:"Remove sorts"})]})},ev=({error:e})=>{let{filters:n}=(0,_.useTableFilter)();return(0,t.jsx)(ed.default,{error:e,className:"pointer-events-auto",subject:"Failed to retrieve rows from table",children:n.length>0&&(0,t.jsx)("p",{children:"Verify that the filter values are correct, as the error may stem from an incorrectly applied filter"})})};var ew=e.i(840645),eS=e.i(701275);function eC(e,n){let{show:r}=(0,ew.useContextMenu)();return(0,t.jsx)(X.Row,{...n,onContextMenu:function(e){r(e,{id:eS.ROW_CONTEXT_MENU_ID,props:{rowIdx:n.rowIdx}})}},e)}let eN=e=>e?.idx??-1,eT=(0,n.memo)((0,n.forwardRef)(({width:e,height:r,containerClass:a,gridClass:s,rowClass:i,rows:l,error:d,isDisabled:p=!1,isLoading:h,isSuccess:m,isError:x},j)=>{let v=(0,y.useIsTableFilterBarEnabled)(),w=(0,g.useTableEditorStateSnapshot)(),S=(0,b.useTableEditorTableStateSnapshot)(),{filters:C,clearFilters:N}=(0,_.useTableFilter)(),{filters:T,clearFilters:k}=U(),{data:R}=(0,Y.useSelectedOrganizationQuery)(),{data:E}=(0,u.useSelectedProjectQuery)(),D=function(e){let r=(0,y.useIsQueueOperationsEnabled)(),a=(0,o.useQueryClient)(),{data:s}=(0,u.useSelectedProjectQuery)(),i=(0,b.useTableEditorTableStateSnapshot)(),l=(0,g.useTableEditorStateSnapshot)(),d=(0,f.useGetImpersonatedRoleState)(),{mutate:p}=(0,el.useTableRowUpdateMutation)({async onMutate({projectRef:e,table:t,configuration:n,payload:r}){let s=new Set(Object.keys(n.identifiers)),i=ei.tableRowKeys.tableRows(e,{table:{id:t.id}});await a.cancelQueries({queryKey:i});let l=a.getQueriesData({queryKey:i});return a.setQueriesData({queryKey:i},e=>({rows:e?.rows.map(e=>Object.entries(e).filter(([e])=>s.has(e)).every(([e,t])=>t===n.identifiers[e])?{...e,...r}:e)??[]})),{previousRowsQueries:l}},onError(e,t,n){let{previousRowsQueries:r}=n;r.forEach(([e,t])=>{t&&a.setQueriesData({queryKey:e},t),a.invalidateQueries({queryKey:e})}),ec.toast.error(e?.message??e)}});return(0,n.useCallback)((n,o)=>{if(!s)return;let u=n[o.indexes[0]],h=e.find(e=>e.idx==u.idx),m=Object.keys(u).find(e=>u[e]!==h[e]);if(!h||!m)return;let x=i.originalTable.columns?.filter(e=>(e?.enums??[]).length>0&&"array"===e.data_type.toLowerCase()).map(e=>e.name),f={};if((0,c.isTableLike)(i.originalTable)&&i.originalTable.primary_keys.forEach(e=>{let t=i.originalTable.columns.find(t=>t.name===e.name);f[e.name]=t?.format==="bytea"?(0,ea.convertByteaToHex)(h[e.name]):h[e.name]}),0===Object.keys(f).length)return(0,ec.toast)("Unable to update row as table has no primary keys",{description:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(es.DocsButton,{href:`${eo.DOCS_URL}/guides/database/tables#primary-keys`})})]})});if(r)(0,er.queueCellEditWithOptimisticUpdate)({queryClient:a,queueOperation:l.queueOperation,projectRef:s.ref,tableId:i.table.id,table:i.originalTable,row:h,rowIdentifiers:f,columnName:m,oldValue:h[m],newValue:u[m],enumArrayColumns:x});else{let e={[m]:u[m]};p({projectRef:s.ref,connectionString:s.connectionString,table:i.originalTable,configuration:{identifiers:f},payload:e,enumArrayColumns:x,roleImpersonationState:d()})}},[d,r,p,s,e,i.originalTable,i.table.id,l,a])}(l),P=(0,n.useRef)(null),I=S.page,L=S.table,O=S.originalTable?.entity_type,M=O===K.ENTITY_TYPE.FOREIGN_TABLE,F=0===(l??[]).length,{mutate:$}=(0,G.useSendEventMutation)(),{isValidFile:Q,isDraggedOver:B,onDragOver:z,onFileDrop:q}=function({enabled:e,onFileDropped:t,onTelemetryEvent:r}){let[a,s]=(0,n.useState)(!1),[i,l]=(0,n.useState)(!1),o=(0,n.useCallback)(t=>{if(!e)return;let[n]=t.dataTransfer.items;n&&"file"!==n.kind||("dragover"!==t.type||a?("dragleave"===t.type||"drop"===t.type)&&(s(!1),l(!1)):(s(!0),l("text/csv"===n.type)),t.stopPropagation(),t.preventDefault())},[e,a,i]),c=(0,n.useCallback)(n=>{if(!e)return;o(n);let[a]=n.dataTransfer.files,[s]=n.dataTransfer.items;s&&"file"!==s.kind||(0,J.flagInvalidFileImport)(a)||(t(a),r?.("import_data_dropzone_file_added"))},[e,o,t,r]);return{isValidFile:i&&a,isDraggedOver:a,onDragOver:o,onFileDrop:c}}({enabled:F&&!M,onFileDropped:e=>w.onImportData((0,et.ref)(e)),onTelemetryEvent:e=>{$({action:e,groups:{project:E?.ref??"Unknown",organization:R?.slug??"Unknown"}})}}),{data:ed}=(0,H.useForeignKeyConstraintsQuery)({projectRef:E?.ref,connectionString:E?.connectionString,schema:L?.schema??void 0}),eu=(0,n.useCallback)(()=>{v?k():N()},[N,k,v]),ep=(0,n.useMemo)(()=>v?T:C,[T,C,v]),eh=(0,n.useMemo)(()=>{let e=(0,c.isTableLike)(S.originalTable)?S.originalTable.primary_keys:[];return 0===w.operationQueue.operations.length?S.gridColumns:S.gridColumns.map(t=>"select-row"===t.key||"add-column"===t.key?t:{...t,cellClass:n=>{let r={};for(let t of e)r[t.name]=n[t.name];return w.hasPendingCellChange(S.table.id,r,t.key)?"rdg-cell--dirty":void 0}})},[S.gridColumns,S.originalTable,S.table.id,w]),em=(0,n.useMemo)(()=>e=>{let t=[];if(i){let n=i(e);n&&t.push(n)}return(0,en.isPendingAddRow)(e)&&t.push("rdg-row--added"),(0,en.isPendingDeleteRow)(e)&&t.push("rdg-row--deleted"),t.length>0?t.join(" "):void 0},[i]);return(0,t.jsxs)("div",{"data-testid":"table-editor-grid-container",className:(0,Z.cn)("flex flex-col relative transition-colors",a),style:{width:e||"100%",height:r||"50vh"},onDragOver:z,onDragLeave:z,onDrop:q,children:[0===(l??[]).length&&(0,t.jsxs)("div",{className:(0,Z.cn)("absolute w-full inset-0 flex flex-col items-center justify-center p-2 z-[1] pointer-events-none",F&&B&&"border-2 border-dashed",Q?"border-brand-600":"border-destructive-600"),children:[h&&!p&&(0,t.jsx)(ee.GenericSkeletonLoader,{className:"w-full top-9 absolute p-2"}),x&&(0,t.jsx)(eg,{error:d}),m&&(0,t.jsx)(t.Fragment,{children:I>1?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,t.jsx)("p",{className:"text-sm text-light",children:"This page does not have any data"}),(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,t.jsx)(A.Button,{type:"default",className:"pointer-events-auto",onClick:()=>S.setPage(1),children:"Head back to first page"})})]}):0===(ep??[]).length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,t.jsx)("p",{className:"text-sm text-light pointer-events-auto",children:B?Q?"Drop your CSV file here":(0,t.jsx)("span",{className:"text-destructive",children:"Only CSV files are accepted"}):"This table is empty"}),O===K.ENTITY_TYPE.FOREIGN_TABLE?(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,t.jsx)("p",{className:"text-sm text-light pointer-events-auto",children:"This table is a foreign table. Add data to the connected source to get started."})}):!B&&(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 mt-4",children:[(0,t.jsx)(A.Button,{type:"default",className:"pointer-events-auto",onClick:()=>{w.onImportData(),$({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:E?.ref??"Unknown",organization:R?.slug??"Unknown"}})},children:"Import data from CSV"}),(0,t.jsx)("p",{className:"text-xs text-foreground-light pointer-events-auto",children:"or drag and drop a CSV file here"})]})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,t.jsx)("p",{className:"text-sm text-light pointer-events-auto",children:"The filters applied have returned no results from this table"}),(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,t.jsx)(A.Button,{type:"default",className:"pointer-events-auto",onClick:()=>eu(),children:"Remove all filters"})})]})})]}),(0,t.jsx)(X.default,{ref:j,className:`${s} flex-grow`,rowClass:em,columns:eh,rows:l??[],renderers:{renderRow:eC},rowKeyGetter:eN,selectedRows:S.selectedRows,onColumnResize:S.updateColumnSize,onRowsChange:D,onSelectedCellChange:function(e){P.current=e,S.setSelectedCellPosition({idx:e.column.idx,rowIdx:e.rowIdx})},onSelectedRowsChange:function(e){S.setSelectedRows(e)},onCellDoubleClick:e=>{var t,n;let r;"string"==typeof e.column.name&&(t=e.row,(r=function(e){let{targetTableSchema:t,targetTableName:n,targetColumnName:r}=L?.columns.find(t=>t.name==e)?.foreignKey??{},a=ed?.find(a=>a.source_schema===L?.schema&&a.source_table===L?.name&&a.source_columns.includes(e)&&a.target_schema===t&&a.target_table===n&&a.target_columns.includes(r??""));return void 0!==a?(0,W.formatForeignKeys)([a])[0]:void 0}((n={name:e.column.name}).name))&&w.onEditForeignKeyColumnValue({foreignKey:r,row:t,column:n}))},onCellKeyDown:V.handleCopyCell})]})}));var ek=e.i(924115),eR=e.i(250503),eE=e.i(731228),eD=e.i(82394),e_=e.i(701087),eP=e.i(847948),eI=e.i(826843),eA=e.i(284399),eL=e.i(503348),eO=e.i(525070),eM=e.i(215312),eF=e.i(302372),e$=e.i(321605),eQ=e.i(587768),eB=e.i(438824),ez=e.i(847278),eq=e.i(2579),eU=e.i(912793),eV=e.i(392491),eW=e.i(967052),eH=e.i(793912),eK=e.i(135144),eG=e.i(689805),eY=e.i(686415),eJ=e.i(242882),eX=e.i(246230);async function eZ({projectRef:e,connectionString:t,id:n},r){let a=(({id:e})=>{if(!e)throw Error("id is required");return`
    with table_info as (
      select 
        n.nspname::text as schema,
        c.relname::text as name,
        to_regclass(concat('"', n.nspname, '"."', c.relname, '"')) as regclass
      from pg_class c
      join pg_namespace n on n.oid = c.relnamespace
      where c.oid = ${e}
    )
    select pg_get_viewdef(t.regclass, true) as definition
    from table_info t
  `.trim()})({id:n}),{result:s}=await (0,ef.executeSql)({projectRef:e,connectionString:t,sql:a,queryKey:["view-definition",n]},r);return s[0].definition.trim()}let e0=({projectRef:e,connectionString:t,id:n},{enabled:r=!0,...a}={})=>(0,eJ.useQuery)({queryKey:eX.databaseKeys.viewDefinition(e,n),queryFn:({signal:r})=>eZ({projectRef:e,connectionString:t,id:n},r),enabled:r&&void 0!==e&&void 0!==n&&!isNaN(n),...a});var e1=e.i(915993),e2=e.i(617361),e5=e.i(396831),e4=e.i(200243);function e3({table:e,isAutofixViewSecurityModalOpen:n,setIsAutofixViewSecurityModalOpen:r}){let{data:a}=(0,u.useSelectedProjectQuery)(),s=(0,o.useQueryClient)(),{isSuccess:i,isPending:l,data:d}=e0({id:e?.id,projectRef:a?.ref,connectionString:a?.connectionString},{enabled:n&&(0,c.isViewLike)(e)}),{mutate:p}=(0,e2.useExecuteSqlMutation)({onSuccess:async()=>{ec.toast.success("View security changed successfully"),r(!1),await s.invalidateQueries({queryKey:e1.lintKeys.lint(a?.ref)})},onError:e=>{ec.toast.error(`Failed to autofix view security: ${e.message}`)}});return(0,c.isViewLike)(e)?(0,t.jsxs)(M.default,{visible:n,size:"xlarge",title:"Confirm autofixing view security",confirmLabel:"Confirm",onCancel:()=>r(!1),onConfirm:()=>{let t;return t=`
	ALTER VIEW "${e.schema}"."${e.name}" SET (security_invoker = on);
	`,void p({projectRef:a?.ref,connectionString:a?.connectionString,sql:t})},children:[(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["Setting ",(0,t.jsx)("code",{children:"security_invoker=on"})," ensures the View runs with the permissions of the querying user, reducing the risk of unintended data exposure."]}),(0,t.jsxs)("div",{className:"flex items-center gap-8 mt-8",children:[(0,t.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,t.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Existing query"}),(0,t.jsxs)(e5.ScrollArea,{className:"h-[225px] px-4 py-2",children:[l&&(0,t.jsx)(ee.GenericSkeletonLoader,{}),i&&(0,t.jsx)(e4.SimpleCodeBlock,{children:`create view ${e.schema}.${e.name} as
 ${d}`})]})]}),(0,t.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,t.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Updated query"}),(0,t.jsxs)(e5.ScrollArea,{className:"h-[225px] px-4 py-2",children:[l&&(0,t.jsx)(ee.GenericSkeletonLoader,{}),i&&(0,t.jsx)(e4.SimpleCodeBlock,{children:`create view ${e.schema}.${e.name} with (security_invoker = on) as
 ${d}`})]})]})]})]}):null}let e6=({table:e,isRefetching:i})=>{let{ref:l}=(0,r.useParams)(),{data:o}=(0,u.useSelectedProjectQuery)(),d=(0,eW.useTrack)(),[p,h]=(0,w.useQueryState)("showWarning",w.parseAsBoolean.withDefault(!1)),{data:m=[]}=(0,eB.useProjectLintsQuery)({projectRef:o?.ref}),{isAvailable:x,isEnabled:f}=(0,eI.useTableIndexAdvisor)(),g=(0,c.isTableLike)(e),y=(0,c.isForeignTable)(e),j=(0,c.isView)(e),v=(0,c.isMaterializedView)(e),{realtimeAll:S}=(0,eU.useIsFeatureEnabled)(["realtime:all"]),{isSchemaLocked:C}=(0,eV.useIsProtectedSchema)({schema:e.schema}),{mutate:N,isPending:T}=(0,ez.useTableUpdateMutation)({onError:e=>{ec.toast.error(`Failed to toggle RLS: ${e.message}`)},onSettled:()=>{er()}}),[k,R]=(0,n.useState)(!1),[E,D]=(0,n.useState)(!1),[_,P]=(0,n.useState)(!1),I=0===(0,b.useTableEditorTableStateSnapshot)().selectedRows.size,O=o?.ref,{data:F}=(0,eF.useDatabasePoliciesQuery)({projectRef:o?.ref,connectionString:o?.connectionString}),$=(F??[]).filter(t=>t.schema===e.schema&&t.table===e.name),{data:Q}=(0,e$.useDatabasePublicationsQuery)({projectRef:o?.ref,connectionString:o?.connectionString}),B=(Q??[]).find(e=>"supabase_realtime"===e.name),z=B?.tables??[],q=z.some(t=>t.id===e?.id),{mutate:U,isPending:V}=(0,eQ.useDatabasePublicationUpdateMutation)({onSuccess:()=>{R(!1),d(q?"table_realtime_disabled":"table_realtime_enabled",{method:"ui",schema_name:e.schema,table_name:e.name})},onError:t=>{ec.toast.error(`Failed to toggle realtime for ${e.name}: ${t.message}`)}}),{can:W,isLoading:H}=(0,eq.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"tables"),{can:K}=(0,eq.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"columns"),G="public"===e.schema,{hasLint:Y}=(0,eL.getEntityLintDetails)(e.name,"rls_disabled_in_public",["ERROR"],m,e.schema),{hasLint:J,matchingLint:X}=(0,eL.getEntityLintDetails)(e.name,"security_definer_view",["ERROR","WARN"],m,e.schema),{hasLint:ee,matchingLint:et}=(0,eL.getEntityLintDetails)(e.name,"materialized_view_in_api",["ERROR","WARN"],m,e.schema),en=async()=>{if(!o||!B)return;let t=z.some(t=>t.id===e.id),n=t?z.filter(t=>t.id!==e.id).map(e=>`${e.schema}.${e.name}`):[`${e.schema}.${e.name}`].concat(z.map(e=>`${e.schema}.${e.name}`));d("realtime_toggle_table_clicked",{newState:t?"disabled":"enabled",origin:"tableGridHeader"}),U({projectRef:o?.ref,connectionString:o?.connectionString,id:B.id,tables:n})},er=()=>{D(!1)},ea=async()=>{let t={id:e.id,rls_enabled:!(g&&e.rls_enabled)};N({projectRef:o?.ref,connectionString:o?.connectionString,id:e.id,name:e.name,schema:e.schema,payload:t}),d("table_rls_enabled",{method:"table_editor",schema_name:e.schema,table_name:e.name})};return(0,t.jsxs)("div",{className:"sb-grid-header__inner",children:[I&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[!H&&!W&&!K&&(0,t.jsxs)(L.Tooltip,{children:[(0,t.jsx)(L.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,t.jsx)(L.TooltipContent,{side:"bottom",children:"You need additional permissions to manage your project's data"})]}),g&&!C?e.rls_enabled?(0,t.jsx)(t.Fragment,{children:$.length<1&&!C?(0,t.jsx)(eM.ButtonTooltip,{asChild:!0,type:"default",className:"group",icon:(0,t.jsx)(eD.PlusCircle,{strokeWidth:1.5,className:"text-foreground-muted"}),tooltip:{content:{side:"bottom",className:"w-[280px]",text:"RLS is enabled for this table, but no policies are set. Select queries may return 0 results."}},children:(0,t.jsx)(s.default,{passHref:!0,href:`/project/${O}/auth/policies?search=${e.name}&schema=${e.schema}`,children:"Add RLS policy"})}):(0,t.jsx)(A.Button,{asChild:!0,type:$.length<1&&!C?"warning":"default",className:"group",icon:C||$.length>0?(0,t.jsx)("div",{className:(0,Z.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",$.length>9?" px-1":"w-[16px]",""),children:(0,t.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:$.length})}):(0,t.jsx)(eD.PlusCircle,{strokeWidth:1.5}),children:(0,t.jsxs)(s.default,{passHref:!0,href:`/project/${O}/auth/policies?search=${e.name}&schema=${e.schema}`,children:["RLS ",$.length>1?"policies":"policy"]})})}):Y?(0,t.jsxs)(eG.Popover_Shadcn_,{modal:!1,open:p,onOpenChange:h,children:[(0,t.jsx)(eK.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"danger",icon:(0,t.jsx)(eR.Lock,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,t.jsxs)(eH.PopoverContent_Shadcn_,{className:"w-80 text-sm",align:"end",children:[(0,t.jsxs)("h4",{className:"flex items-center gap-2",children:[(0,t.jsx)(eR.Lock,{size:16})," Row Level Security (RLS)"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-xs",children:[(0,t.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,t.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!C&&(0,t.jsx)(A.Button,{type:"default",className:"mt-2 w-min",onClick:()=>D(!E),children:"Enable RLS for this table"})]})]})]}):null:null,g&&x&&!f&&(0,t.jsxs)(eG.Popover_Shadcn_,{modal:!1,children:[(0,t.jsx)(eK.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"default",icon:(0,t.jsx)(ek.Lightbulb,{strokeWidth:1.5}),children:"Index Advisor"})}),(0,t.jsxs)(eH.PopoverContent_Shadcn_,{className:"w-80 text-sm",align:"end",children:[(0,t.jsxs)("h4",{className:"flex items-center gap-2",children:[(0,t.jsx)(ek.Lightbulb,{size:16})," Index Advisor"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-xs",children:[(0,t.jsx)("p",{children:"Index Advisor recommends indexes to improve query performance on this table."}),(0,t.jsx)("p",{children:"Enable Index Advisor to get recommendations based on your actual query patterns."}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(eA.EnableIndexAdvisorButton,{})})]})]})]}),S&&(0,t.jsx)(eM.ButtonTooltip,{type:"default",size:"tiny",icon:(0,t.jsx)(eE.MousePointer2,{strokeWidth:1.5,className:q?"text-brand":"text-foreground-muted"}),onClick:()=>R(!0),className:(0,Z.cn)(q&&"w-7 h-7 p-0 text-brand hover:text-brand-hover"),tooltip:{content:{side:"bottom",text:q?"Click to disable realtime for this table":"Click to enable realtime for this table"}},children:!q&&"Enable Realtime"}),j&&J&&(0,t.jsxs)(eG.Popover_Shadcn_,{modal:!1,open:p,onOpenChange:h,children:[(0,t.jsx)(eK.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"warning",icon:(0,t.jsx)(e_.Unlock,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,t.jsxs)(eH.PopoverContent_Shadcn_,{className:"min-w-[395px] text-sm",align:"end",children:[(0,t.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,t.jsx)(e_.Unlock,{size:16})," Secure your View"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,t.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,t.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,t.jsx)(A.Button,{type:"secondary",onClick:()=>{P(!0)},children:"Autofix"}),(0,t.jsx)(A.Button,{type:"default",asChild:!0,children:(0,t.jsx)(s.default,{target:"_blank",href:`/project/${l}/advisors/security?preset=${X?.level}&id=${X?.cache_key}`,children:"Learn more"})})]})]})]})]}),v&&ee&&(0,t.jsxs)(eG.Popover_Shadcn_,{modal:!1,open:p,onOpenChange:h,children:[(0,t.jsx)(eK.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"warning",icon:(0,t.jsx)(e_.Unlock,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,t.jsxs)(eH.PopoverContent_Shadcn_,{className:"min-w-[395px] text-sm",align:"end",children:[(0,t.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,t.jsx)(e_.Unlock,{size:16})," Secure your View"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,t.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,t.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(A.Button,{type:"default",asChild:!0,children:(0,t.jsx)(s.default,{target:"_blank",href:`/project/${l}/advisors/security?preset=${et?.level}&id=${et?.cache_key}`,children:"Learn more"})})})]})]})]}),y&&"public"===e.schema&&(0,t.jsxs)(eG.Popover_Shadcn_,{modal:!1,open:p,onOpenChange:h,children:[(0,t.jsx)(eK.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"warning",icon:(0,t.jsx)(e_.Unlock,{strokeWidth:1.5}),children:"Unprotected Data API access"})}),(0,t.jsxs)(eH.PopoverContent_Shadcn_,{className:"min-w-[395px] text-sm",align:"end",children:[(0,t.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,t.jsx)(e_.Unlock,{size:16})," Secure Foreign table"]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,t.jsxs)("p",{children:["Foreign tables do not enforce RLS, which may allow unrestricted access. To secure them, either move foreign tables to a private schema not exposed by PostgREST, or ",(0,t.jsx)("a",{href:"",children:"disable PostgREST access"})," entirely."]}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(A.Button,{type:"default",asChild:!0,children:(0,t.jsx)(s.default,{target:"_blank",href:`${eo.DOCS_URL}/guides/database/extensions/wrappers/overview#security`,children:"Learn more"})})})]})]})]}),(0,t.jsx)(eY.RoleImpersonationPopover,{serviceRoleLabel:"postgres"}),G&&(0,t.jsx)(eO.APIDocsButton,{section:["entities",e.name],source:"table_editor"}),(0,t.jsx)(eP.RefreshButton,{tableId:e.id,isRefetching:i})]}),(0,t.jsx)(M.default,{visible:k,loading:V,title:`${q?"Disable":"Enable"} realtime for ${e.name}`,confirmLabel:`${q?"Disable":"Enable"} realtime`,confirmLabelLoading:`${q?"Disabling":"Enabling"} realtime`,onCancel:()=>R(!1),onConfirm:()=>en(),children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",q?"disabled":"enabled",", the table will"," ",q?"no longer ":"","broadcast any changes to authorized subscribers."]}),!q&&(0,t.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,t.jsx)(s.default,{href:`/project/${l}/database/publications`,className:"text-brand",children:"database publications"})," ","settings."]})]})}),(0,t.jsx)(e3,{table:e,isAutofixViewSecurityModalOpen:_,setIsAutofixViewSecurityModalOpen:P}),g&&(0,t.jsx)(M.default,{visible:E,variant:e.rls_enabled?"destructive":"default",title:`${e.rls_enabled?"Disable":"Enable"} Row Level Security`,description:`Are you sure you want to ${e.rls_enabled?"disable":"enable"} Row Level Security for this table?`,confirmLabel:`${e.rls_enabled?"Disable":"Enable"} RLS`,confirmLabelLoading:`${e.rls_enabled?"Disabling":"Enabling"} RLS`,loading:T,onCancel:er,onConfirm:ea})]})};var e8=e.i(534517),e7=e.i(749844),e9=e.i(88816),te=e.i(291969),tt=e.i(211570),tn=e.i(874311),tr=e.i(479095),ta=e.i(375761),ts=e.i(73011),ti=e.i(586468);let tl=({rows:e,columns:t})=>{let n=e.map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));return ti.default.unparse(n,{columns:t})};var to=e.i(816232);let tc=()=>{let{urlFilters:e,onApplyFilters:r}=(0,_.useTableFilter)(),a=(0,n.useMemo)(()=>(0,V.formatFilterURLParams)(e??[]),[e]);return(0,t.jsx)(to.FilterPopoverPrimitive,{filters:a,onApplyFilters:r})};var td=e.i(626915);let tu=({tableQueriesEnabled:e})=>{let{urlSorts:r,onApplySorts:a}=(0,P.useTableSort)(),s=(0,b.useTableEditorTableStateSnapshot)(),i=s.table?.name||"",l=(0,n.useMemo)(()=>i&&r?(0,V.formatSortURLParams)(i,r):[],[i,r]);return(0,t.jsx)(td.SortPopoverPrimitive,{sorts:l,onApplySorts:a,tableQueriesEnabled:e})},tp=({customHeader:e,isRefetching:n,tableQueriesEnabled:r=!0})=>{let a=(0,b.useTableEditorTableStateSnapshot)();return(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex h-10 items-center justify-between bg-dash-sidebar dark:bg-surface-100 px-1.5 py-1.5 gap-2 overflow-x-auto ",children:[e||(a.selectedRows.size>0?(0,t.jsx)(tm,{tableQueriesEnabled:r}):(0,t.jsx)(th,{tableQueriesEnabled:r})),(0,t.jsx)(e6,{table:a.originalTable,isRefetching:n})]})})},th=({tableQueriesEnabled:e=!0})=>{let{ref:n}=(0,r.useParams)(),{data:s}=(0,Y.useSelectedOrganizationQuery)(),i=(0,b.useTableEditorTableStateSnapshot)(),l=(0,g.useTableEditorStateSnapshot)(),{can:o}=(0,eq.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"columns"),{mutate:c}=(0,G.useSendEventMutation)(),d=i.editable&&(i.table.columns??[]).length>0?l.onAddRow:void 0,u=i.editable?l.onAddColumn:void 0,p=i.editable?l.onImportData:void 0;return(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(tc,{}),(0,t.jsx)(tu,{tableQueriesEnabled:e})]}),(void 0!==d||void 0!==u)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-[20px] w-px border-r border-control"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:o&&(0,t.jsxs)(tn.DropdownMenu,{children:[(0,t.jsx)(tn.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(A.Button,{"data-testid":"table-editor-insert-new-row",type:"primary",size:"tiny",icon:(0,t.jsx)(e9.ChevronDown,{strokeWidth:1.5}),children:"Insert"})}),(0,t.jsx)(tn.DropdownMenuContent,{side:"bottom",align:"start",children:[...void 0!==d?[(0,t.jsxs)(tn.DropdownMenuItem,{className:"group space-x-2",onClick:d,children:[(0,t.jsxs)("div",{className:"-mt-2 pr-1.5",children:[(0,t.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px]"}),(0,t.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px] my-[2px]"}),(0,t.jsx)("div",{className:(0,Z.cn)(["border border-foreground-light w-[15px] h-[4px] translate-x-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-x-0"])})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"Insert row"}),(0,t.jsxs)("p",{className:"text-foreground-light",children:["Insert a new row into ",i.table.name]})]})]},"add-row")]:[],...void 0!==u?[(0,t.jsxs)(tn.DropdownMenuItem,{className:"group space-x-2",onClick:u,children:[(0,t.jsxs)("div",{className:"flex -mt-2 pr-1.5",children:[(0,t.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px]"}),(0,t.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px] mx-[2px]"}),(0,t.jsx)("div",{className:(0,Z.cn)(["border border-foreground-light w-[4px] h-[15px] -translate-y-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-y-0"])})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"Insert column"}),(0,t.jsxs)("p",{className:"text-foreground-light",children:["Insert a new column into ",i.table.name]})]})]},"add-column")]:[],...void 0!==p?[(0,t.jsxs)(tn.DropdownMenuItem,{className:"group space-x-2",onClick:()=>{p(),c({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:n??"Unknown",organization:s?.slug??"Unknown"}})},children:[(0,t.jsxs)("div",{className:"relative -mt-2",children:[(0,t.jsx)(te.FileText,{size:18,strokeWidth:1.5,className:"-translate-x-[2px]"}),(0,t.jsx)(e7.ArrowUp,{className:(0,Z.cn)("transition duration-200 absolute bottom-0 right-0 translate-y-1 opacity-0 bg-brand-400 rounded-full","group-data-[highlighted]:translate-y-0 group-data-[highlighted]:text-brand group-data-[highlighted]:opacity-100"),strokeWidth:3,size:12})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"Import data from CSV"}),(0,t.jsx)("p",{className:"text-foreground-light",children:"Insert new rows from a CSV"})]})]},"import-data")]:[]]})]})})]})]})},tm=({tableQueriesEnabled:e=!0})=>{let r=(0,o.useQueryClient)(),{data:a}=(0,u.useSelectedProjectQuery)(),s=(0,g.useTableEditorStateSnapshot)(),i=(0,b.useTableEditorTableStateSnapshot)(),c=(0,y.useIsQueueOperationsEnabled)(),p=(0,f.useRoleImpersonationStateSnapshot)(),h=void 0!==p.role,{filters:m}=(0,_.useTableFilter)(),{sorts:x}=(0,P.useTableSort)(),[j,v]=(0,n.useState)(!1),[w,S]=(0,n.useState)(!1),{data:C}=(0,d.useTableRowsQuery)({projectRef:a?.ref,connectionString:a?.connectionString,tableId:i.table.id,sorts:x,filters:m,page:i.page,limit:s.rowsPerPage,roleImpersonationState:p},{enabled:e}),{data:N}=(0,I.useTableRowsCountQuery)({projectRef:a?.ref,connectionString:a?.connectionString,tableId:i.table.id,filters:m,enforceExactCount:i.enforceExactCount,roleImpersonationState:p},{placeholderData:l.keepPreviousData,enabled:e}),T=C?.rows??[],k=N?.count??0,R=e=>{let t=T.filter(e=>i.selectedRows.has(e.idx));if("csv"===e){let e=tl({rows:t,columns:i.table.columns.map(e=>e.name)});(0,ta.copyToClipboard)(e)}else if("sql"===e){let e=(0,eL.formatTableRowsToSQL)(i.table,t);(0,ta.copyToClipboard)(e)}else"json"===e&&(0,ta.copyToClipboard)(JSON.stringify(t));ec.toast.success("Copied rows to clipboard")},E=i.allRowsSelected?{type:"fetch_all",filters:m,sorts:x}:{type:"provided_rows",table:i.table,rows:T.filter(e=>i.selectedRows.has(e.idx))},{exportCsv:D,confirmationModal:L}=(0,e8.useExportAllRowsAsCsv)(a?{enabled:!0,projectRef:a.ref,connectionString:a?.connectionString??null,entity:i.table,totalRows:k,...E}:{enabled:!1}),O=async()=>{if(v(!0),!a)return ec.toast.error("Project is required"),v(!1);D(),v(!1)},{exportSql:M,confirmationModal:F}=(0,e8.useExportAllRowsAsSql)(a?{enabled:!0,projectRef:a.ref,connectionString:a?.connectionString??null,entity:i.table,...E}:{enabled:!1}),$=async()=>{if(v(!0),!a)return ec.toast.error("Project is required"),v(!1);M(),v(!1)},{exportJson:Q,confirmationModal:B}=(0,e8.useExportAllRowsAsJson)(a?{enabled:!0,projectRef:a.ref,connectionString:a?.connectionString??null,entity:i.table,...E}:{enabled:!1}),z=async()=>{if(!a)return ec.toast.error("Project is required");v(!0),Q(),v(!1)};return(0,f.useSubscribeToImpersonatedRole)(()=>{(i.allRowsSelected||i.selectedRows.size>0)&&i.resetSelectedRows()}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[i.editable&&(0,t.jsx)(eM.ButtonTooltip,{type:"default",size:"tiny",icon:(0,t.jsx)(tt.Trash,{}),onClick:()=>{let e=Array.from(i.selectedRows),t=T.filter(t=>e.includes(t.idx));if(c&&!i.allRowsSelected){(0,er.queueRowDeletesWithOptimisticUpdate)({rows:t,table:i.originalTable,queryClient:r,queueOperation:s.queueOperation,projectRef:a?.ref}),i.resetSelectedRows();return}s.onDeleteRows(t,{allRowsSelected:i.allRowsSelected,numRows:i.allRowsSelected?k:t.length,callback:()=>{i.resetSelectedRows()}})},disabled:i.allRowsSelected&&h,tooltip:{content:{side:"bottom",text:i.allRowsSelected&&h?"Table truncation is not supported when impersonating a role":void 0}},children:i.allRowsSelected?"Delete all rows in table":i.selectedRows.size>1?`Delete ${i.selectedRows.size} rows`:`Delete ${i.selectedRows.size} row`}),i.allRowsSelected?(0,t.jsx)(eM.ButtonTooltip,{disabled:!0,type:"default",tooltip:{content:{side:"bottom",className:"w-64 text-center",text:"Copy to clipboard is not supported while all rows in the table are selected"}},children:"Copy"}):(0,t.jsxs)(tn.DropdownMenu,{children:[(0,t.jsx)(tn.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"default",size:"tiny",iconRight:(0,t.jsx)(e9.ChevronDown,{}),loading:j,disabled:j,children:"Copy"})}),(0,t.jsxs)(tn.DropdownMenuContent,{align:"start",className:"w-40",children:[(0,t.jsx)(tn.DropdownMenuItem,{onClick:()=>R("csv"),children:"Copy as CSV"}),(0,t.jsx)(tn.DropdownMenuItem,{onClick:()=>R("sql"),children:"Copy as SQL"}),(0,t.jsx)(tn.DropdownMenuItem,{onClick:()=>R("json"),children:"Copy as JSON"})]})]}),(0,t.jsxs)(tn.DropdownMenu,{children:[(0,t.jsx)(tn.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"default",size:"tiny",iconRight:(0,t.jsx)(e9.ChevronDown,{}),loading:j,disabled:j,children:"Export"})}),(0,t.jsxs)(tn.DropdownMenuContent,{align:"start",className:i.allRowsSelected?"w-52":"w-40",children:[(0,t.jsx)(tn.DropdownMenuItem,{onClick:O,children:"Export as CSV"}),(0,t.jsx)(tn.DropdownMenuItem,{onClick:$,children:"Export as SQL"}),i.allRowsSelected?(0,t.jsx)(tn.DropdownMenuItem,{className:"group",onClick:()=>S(!0),children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"group-hover:text-foreground",children:"Export via CLI"}),(0,t.jsx)("p",{className:"text-foreground-lighter",children:"Recommended for large tables"})]})}):(0,t.jsx)(tn.DropdownMenuItem,{onClick:z,children:"Export as JSON"})]})]}),!i.allRowsSelected&&k>T.length&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-6 ml-0.5",children:(0,t.jsx)(tr.Separator,{orientation:"vertical"})}),(0,t.jsx)(A.Button,{type:"text",onClick:()=>void i.setSelectedRows(new Set(T.map(e=>e.idx)),!0),children:"Select all rows in table"})]})]}),(0,t.jsx)(ts.ExportDialog,{table:i.table,filters:m,sorts:x,open:w,onOpenChange:()=>S(!1)}),L,F,B]})};var tx=e.i(200722),tf=e.i(804222),tg=e.i(38429),tb=e.i(234745);e.i(56031);var ty=e.i(237948);async function tj({prompt:e,filterProperties:t,currentPath:n}){let r=`${eo.BASE_PATH}/api/ai/sql/filter-v1`,a=await (0,tb.constructHeaders)({"Content-Type":"application/json"}),s=await (0,tb.fetchHandler)(r,{headers:a,method:"POST",body:JSON.stringify({prompt:e,filterProperties:t,currentPath:n})});if(!s.ok){let e="Failed to generate filters";try{let t=await s.json();e=t?.error||t?.message||e}catch{}throw new ty.ResponseError(e,s.status)}return await s.json()}var tv=e.i(261348),tw=e.i(299863),tS=e.i(265100),tC=e.i(366652);function tN(e){return"logicalOperator"in e}function tT(e,t){return e.length===t.length&&e.every((e,n)=>e===t[n])}function tk(e,t){if(0===t.length)return e;let[n,...r]=t,a=e.conditions[n];return a?0===r.length?tN(a)?a:null:tN(a)?tk(a,r):null:null}function tR(e,t){if(0===t.length)return null;let[n,...r]=t,a=e.conditions[n];return a?0===r.length?tN(a)?null:a:tN(a)?tR(a,r):null:null}function tE(e){return"object"==typeof e&&null!==e&&"component"in e}function tD(e){return"object"==typeof e&&null!==e&&"value"in e&&"label"in e}function t_(e){if(!e||Array.isArray(e)||tE(e)||"function"!=typeof e)return!1;let t=e.toString();return"AsyncFunction"===e.constructor.name||t.startsWith("async ")||t.includes("async function")}function tP(e,t){if(1===t.length)return{...e,conditions:e.conditions.filter((e,n)=>n!==t[0])};let[n,...r]=t;return{...e,conditions:e.conditions.map((e,t)=>t===n?tP(e,r):e)}}function tI(e,t){return(0,n.useCallback)(n=>{setTimeout(()=>{let n=document.activeElement;n&&e.current&&e.current.contains(n)||n&&n.closest("[data-radix-popper-content-wrapper]")||t()},0)},[e,t])}function tA(e,t,r,a){let[s,i]=(0,n.useState)(0);(0,n.useEffect)(()=>{s>e-1&&i(e>0?e-1:0)},[e,s]);let l=(0,n.useCallback)(n=>{if("ArrowDown"===n.key){n.preventDefault(),i(t=>t<e-1?t+1:t);return}if("ArrowUp"===n.key){n.preventDefault(),i(e=>e>0?e-1:0);return}if("Enter"===n.key||"Tab"===n.key){if(a?.skipEnterWhenFilterHighlighted){r&&r(n);return}if(e>0){n.preventDefault(),t(s);return}r&&r(n);return}if("Backspace"===n.key){r&&r(n);return}r&&r(n)},[e,s,t,r,a?.skipEnterWhenFilterHighlighted]),o=(0,n.useCallback)(()=>i(0),[]);return{highlightedIndex:s,setHighlightedIndex:i,handleKeyDown:l,reset:o}}let tL=(0,n.createContext)(null);function tO(){let e=(0,n.useContext)(tL);if(!e)throw Error("useFilterBar must be used within FilterBar.Root");return e}function tM({children:e,filterProperties:r,filters:a,onFilterChange:s,freeformText:i,onFreeformTextChange:l,actions:o,isLoading:c,supportsOperators:d=!1,variant:u="default",icon:p}){let h=(0,n.useRef)(null),{isLoading:m,error:x,hideTimeoutRef:f,activeInput:g,setActiveInput:b,newPathRef:y,setIsCommandMenuVisible:j,highlightedConditionPath:v,setHighlightedConditionPath:w}=function(){let[e,t]=(0,n.useState)(!1),[r,a]=(0,n.useState)(null),[s,i]=(0,n.useState)(!1),l=(0,n.useRef)(null),[o,c]=(0,n.useState)(null),d=(0,n.useRef)([]),[u,p]=(0,n.useState)(null);return{isLoading:e,setIsLoading:t,error:r,setError:a,isCommandMenuVisible:s,setIsCommandMenuVisible:i,hideTimeoutRef:l,activeInput:o,setActiveInput:c,newPathRef:d,highlightedConditionPath:u,setHighlightedConditionPath:p}}(),{loadingOptions:S,propertyOptionsCache:C,loadPropertyOptions:N,optionsError:T}=function(){let[e,t]=(0,n.useState)({}),[r,a]=(0,n.useState)({}),[s,i]=(0,n.useState)(null),l=(0,n.useRef)(null),o=(0,n.useCallback)(async(n,s="")=>{if(!n.options||Array.isArray(n.options)||!t_(n.options))return;let o=r[n.name];o&&o.searchValue===s||(l.current&&clearTimeout(l.current),l.current=setTimeout(async()=>{if(!e[n.name])try{t(e=>({...e,[n.name]:!0}));let e=n.options,r=(await e(s)).map(e=>"string"==typeof e?{label:e,value:e}:e);a(e=>({...e,[n.name]:{options:r,searchValue:s}}))}catch(e){console.error(`Error loading options for ${n.name}:`,e),i(`Failed to load options for ${n.label}`)}finally{t(e=>({...e,[n.name]:!1}))}},300))},[e,r]);return(0,n.useEffect)(()=>()=>{l.current&&clearTimeout(l.current)},[]),{loadingOptions:e,propertyOptionsCache:r,loadPropertyOptions:o,optionsError:s,setOptionsError:i}}(),k=(0,n.useCallback)((e,t)=>{let n=function e(t,n,r){if(1===n.length)return{...t,conditions:t.conditions.map((e,t)=>t===n[0]?{...e,value:r}:e)};let[a,...s]=n;return{...t,conditions:t.conditions.map((t,n)=>n===a&&tN(t)?e(t,s,r):t)}}(a,e,t);s(n);let i=tR(n,e);if(i){let e=r.find(e=>e.name===i.propertyName);e&&e.options&&!Array.isArray(e.options)&&t_(e.options)&&N(e,t)}},[a,s,r,N]),R=(0,n.useCallback)((e,t)=>{s(function e(t,n,r){if(1===n.length)return{...t,conditions:t.conditions.map((e,t)=>t===n[0]?{...e,operator:r}:e)};let[a,...s]=n;return{...t,conditions:t.conditions.map((t,n)=>n===a&&tN(t)?e(t,s,r):t)}}(a,e,t))},[a,s]),{handleItemSelect:E}=function({activeInput:e,setActiveInput:t,activeFilters:r,onFilterChange:a,filterProperties:s,freeformText:i,onFreeformTextChange:l,handleInputChange:o,handleOperatorChange:c,newPathRef:d,setIsCommandMenuVisible:u}){let p=(0,n.useCallback)(()=>{if(e&&"group"===e.type){let n=e.path,s=tk(r,n);s&&(a(function e(t,n){if(0===n.length)return{...t,conditions:[...t.conditions,{logicalOperator:"AND",conditions:[]}]};let[r,...a]=n;return{...t,conditions:t.conditions.map((t,n)=>n===r?e(t,a):t)}}(r,n)),d.current=[...n,s.conditions.length],setTimeout(()=>{t({type:"group",path:d.current})},0),l(""))}},[e,r,a,d,t,l]),h=(0,n.useCallback)(n=>{if(!e||"value"!==e.type)return;let r=e.path;o(r,n.value),setTimeout(()=>{t({type:"group",path:r.slice(0,-1)})},0)},[e,o,t]),m=(0,n.useCallback)(n=>{if(!e||"operator"!==e.type)return;let r=e.path;c(r,n),t({type:"value",path:r})},[e,c,t]),x=(0,n.useCallback)((e,n,s)=>{a(function e(t,n,r){if(0===n.length)return{...t,conditions:[...t.conditions,{propertyName:r.name,value:"",operator:""}]};let[a,...s]=n;return{...t,conditions:t.conditions.map((t,n)=>n===a?e(t,s,r):t)}}(r,n,e));let i=[...n,s.conditions.length];setTimeout(()=>{t({type:"operator",path:i})},0)},[r,a,t]),f=(0,n.useCallback)(t=>{if(!e||"group"!==e.type)return;let n=s.find(e=>e.name===t);if(!n)return void console.error(`Invalid property: ${t}`);let a=e.path,i=tk(r,a);i&&(n.options&&!Array.isArray(n.options)&&tE(n.options),x(n,a,i),l(""))},[e,s,r,l,x]);return{handleItemSelect:(0,n.useCallback)(n=>{let a=n.value;if(n.isAction&&n.action){let a=e?.type==="group"?e.path:[];Promise.resolve(n.action.onSelect(n.actionInputValue??i??"",{path:a,activeFilters:r})).catch(e=>console.error("FilterBar action failed",e)).finally(()=>{u(!1),t(null)});return}"group"===n.value?p():e?.type==="value"?h(n):e?.type==="operator"?m(a):e?.type==="group"&&f(a)},[e,r,i,t,p,h,m,f,u])}}({activeInput:g,setActiveInput:b,activeFilters:a,onFilterChange:s,filterProperties:r,freeformText:i,onFreeformTextChange:l,handleInputChange:k,handleOperatorChange:R,newPathRef:y,setIsCommandMenuVisible:j}),{handleKeyDown:D}=function({activeInput:e,setActiveInput:t,activeFilters:r,onFilterChange:a,highlightedConditionPath:s,setHighlightedConditionPath:i}){let l=(0,n.useCallback)(e=>{a(tP(r,e))},[r,a]),o=(0,n.useCallback)(e=>{let t=tk(r,e);return t&&0!==t.conditions.length?"logicalOperator"in t.conditions[0]?o([...e,0]):[...e,0]:null},[r]),c=(0,n.useCallback)(e=>{let t=tk(r,e);if(!t||0===t.conditions.length)return null;let n=t.conditions[t.conditions.length-1],a=t.conditions.length-1;return"logicalOperator"in n?c([...e,a]):[...e,a]},[r]),d=(0,n.useCallback)(e=>{let t=e.slice(0,-1),n=e[e.length-1];if(n>0){let e=[...t,n-1],a=tk(r,t),s=a?.conditions[n-1];if(s&&!("logicalOperator"in s))return e;if(s&&"logicalOperator"in s)return c(e)}return t.length>0?d(t):null},[r,c]),u=(0,n.useCallback)(t=>{if(e?.type!=="group")return null;let n=tk(r,e.path);if(!n||0===n.conditions.length)return null;if(s){let r=s[s.length-1];return"prev"===t?r>0?[...e.path,r-1]:"clear":r<n.conditions.length-1?[...e.path,r+1]:"clear"}return"prev"===t?[...e.path,n.conditions.length-1]:null},[e,r,s]),p=(0,n.useCallback)(e=>{"clear"===e?i(null):e&&i(e)},[i]),h=(0,n.useCallback)(n=>{if(e?.type==="operator")return;let a=""===n.target.value;if(e?.type==="group"&&a)n.preventDefault(),s?(l(s),i(null)):p(u("prev"));else if(e?.type==="group"&&e.path.length>0){let a=tk(r,e.path);a&&0===a.conditions.length&&(n.preventDefault(),l(e.path),t({type:"group",path:e.path.slice(0,-1)}))}else if(e?.type==="value"&&a){let a=tR(r,e.path);a&&!a.value&&(n.preventDefault(),t({type:"operator",path:e.path}))}},[e,r,l,t,s,i,u,p]),m=(0,n.useCallback)(n=>{let r=n.target,a=""===r.value;if(e?.type==="group"&&a){n.preventDefault(),p(u("prev"));return}if(e?.type==="value"&&0===r.selectionStart){n.preventDefault();let r=d(e.path);r&&t({type:"value",path:r})}},[e,u,p,d,t]),x=(0,n.useCallback)(n=>{let a=n.target,i=""===a.value;if(e?.type==="group"&&i&&s){n.preventDefault(),p(u("next"));return}if(e?.type==="value"&&a.selectionStart===a.value.length){n.preventDefault();let a=e.path.slice(0,-1),s=e.path[e.path.length-1],i=tk(r,a);if(i&&s<i.conditions.length-1)if("logicalOperator"in i.conditions[s+1]){let e=o([...a,s+1]);e&&t({type:"value",path:e})}else t({type:"value",path:[...a,s+1]});else t({type:"group",path:a})}},[e,r,s,u,p,o,t]);return{handleKeyDown:(0,n.useCallback)(n=>{if("Backspace"===n.key)h(n);else if("ArrowLeft"===n.key)m(n);else if("ArrowRight"===n.key)x(n);else if("Escape"===n.key)if(s)n.preventDefault(),i(null);else{let e=document.activeElement;e&&e.blur&&e.blur()}else"Enter"===n.key&&(s?(n.preventDefault(),t({type:"value",path:s}),i(null)):e?.type==="value"?(n.preventDefault(),t({type:"group",path:e.path.slice(0,-1)})):e?.type==="operator"&&(n.preventDefault(),t({type:"value",path:e.path})))},[e,h,m,x,t,s,i])}}({activeInput:g,setActiveInput:b,activeFilters:a,onFilterChange:s,highlightedConditionPath:v,setHighlightedConditionPath:w}),_=(0,n.useCallback)(e=>{b({type:"value",path:e}),j(!0),f.current&&clearTimeout(f.current);let t=tR(a,e);if(t){let e=r.find(e=>e.name===t.propertyName);e&&e.options&&!Array.isArray(e.options)&&t_(e.options)&&N(e,t.value?.toString()||"")}},[a,r,N,b,j,f]),P=(0,n.useCallback)(e=>{b({type:"operator",path:e}),j(!0),f.current&&clearTimeout(f.current)},[b,j,f]),I=(0,n.useCallback)(e=>{b({type:"group",path:e}),j(!0),f.current&&clearTimeout(f.current)},[b,j,f]),A=(0,n.useCallback)(()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{let e=document.activeElement;e&&h.current&&h.current.contains(e)||(j(!1),b(null),w(null))},0)},[j,b,f,w]),L=(0,n.useCallback)((e,t)=>{v&&w(null),l(t)},[l,v,w]),O=(0,n.useCallback)(e=>{b({type:"value",path:e})},[b]),M=(0,n.useCallback)(e=>{s(function e(t,n){if(0===n.length)return{...t,logicalOperator:"AND"===t.logicalOperator?"OR":"AND"};let[r,...a]=n;return{...t,conditions:t.conditions.map((t,n)=>n===r&&tN(t)?e(t,a):t)}}(a,e))},[a,s]),F=(0,n.useCallback)(e=>{s(tP(a,e)),b(null)},[a,s,b]);return(0,n.useEffect)(()=>()=>{f.current&&clearTimeout(f.current)},[f]),(0,t.jsx)(tL.Provider,{value:{filters:a,filterProperties:r,activeInput:g,freeformText:i,isLoading:c??m,error:x,highlightedConditionPath:v,onFilterChange:s,onFreeformTextChange:l,setActiveInput:b,handleInputChange:k,handleOperatorChange:R,handleRemoveCondition:F,handleKeyDown:D,handleSelectMenuItem:E,handleInputFocus:_,handleOperatorFocus:P,handleGroupFreeformFocus:I,handleInputBlur:A,handleGroupFreeformChange:L,handleLabelClick:O,handleLogicalOperatorChange:M,propertyOptionsCache:C,loadingOptions:S,loadPropertyOptions:N,optionsError:T,supportsOperators:d,variant:u,actions:o,icon:p,rootRef:h},children:(0,t.jsx)("div",{ref:h,"data-filterbar-root":!0,className:"h-full min-h-[26px] flex items-stretch",children:e})})}var tF=e.i(378277),t$=e.i(767073),t$=t$,tQ=e.i(866205),tB=e.i(703526),tz=e.i(917007),tq=e.i(549815),tU=e.i(911509);function tV({items:e,highlightedIndex:n,onSelect:r,includeIcon:a=!0}){return(0,t.jsx)(tQ.Command_Shadcn_,{children:(0,t.jsxs)(tU.CommandList_Shadcn_,{children:[(0,t.jsx)(tB.CommandEmpty_Shadcn_,{children:"No results found."}),(0,t.jsx)(tz.CommandGroup_Shadcn_,{children:e.map((e,s)=>(0,t.jsxs)(tq.CommandItem_Shadcn_,{value:e.value,onSelect:()=>r(e),className:`text-xs ${s===n?"bg-surface-400":""}`,children:[a&&e.icon,e.label]},`${e.value}-${e.label}`))})]})})}var tW=e.i(975924),t$=t$;function tH({condition:e,path:r,isActive:a,isOperatorActive:s,isHighlighted:i}){let{filters:l,filterProperties:o,isLoading:c,propertyOptionsCache:d,loadingOptions:u,handleOperatorChange:p,handleInputChange:h,handleOperatorFocus:m,handleInputFocus:x,handleInputBlur:f,handleLabelClick:g,handleKeyDown:b,handleRemoveCondition:y,handleSelectMenuItem:j,setActiveInput:v,variant:w}=tO(),S=(0,n.useRef)(null),C=(0,n.useRef)(null),N=(0,n.useRef)(null),T=o.find(t=>t.name===e.propertyName),[k,R]=(0,n.useState)(!1),[E,D]=(0,n.useState)(!1),[_,P]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s||D(!1)},[s,D]),(0,n.useEffect)(()=>{a||P(!1)},[a,P]),(0,n.useEffect)(()=>{a&&C.current?C.current.focus():s&&S.current&&S.current.focus()},[a,s]);let I=tI(N,f),L=tI(N,f),O=(0,n.useMemo)(()=>(function(e,t,n,r=!0){if(!e)return[];let a=tR(t,e.path),s=n.find(e=>e.name===a?.propertyName),i=a?.operator?.toUpperCase()||"",l=s?.operators||["="],o=r&&i.length>0;return l.filter(e=>!o||(tD(e)?e.value.toUpperCase().includes(i)||e.label.toUpperCase().includes(i):e.toUpperCase().includes(i))).map(e=>tD(e)?{value:e.value,label:`${e.label} (${e.value})`}:{value:e,label:e})})({type:"operator",path:r},l,o,E),[r,l,o,E]),M=(0,n.useMemo)(()=>(function(e,t,n,r,a,s,i=!0){if(!e)return[];let l=tR(t,e.path),o=n.find(e=>e.name===l?.propertyName),c=[];return o&&(!Array.isArray(o.options)&&tE(o.options)?c.push({value:"custom",label:o.options.label||"Custom...",isCustom:!0,customOption:o.options.component}):a[o.name]?c.push({value:"loading",label:"Loading options..."}):Array.isArray(o.options)?c.push(...function(e,t,n){let r=[],a=t.toLowerCase(),s=n&&t.length>0;for(let t of e)if("string"==typeof t)(!s||t.toLowerCase().includes(a))&&r.push({value:t,label:t});else"object"==typeof t&&null!==t&&"value"in t&&"label"in t?(!s||t.label.toLowerCase().includes(a))&&r.push({value:t.value,label:t.label}):tE(t)&&(!s||(t.label?.toLowerCase().includes(a)??!0))&&r.push({value:"custom",label:t.label||"Custom...",isCustom:!0,customOption:t.component});return r}(o.options,s,i)):r[o.name]&&c.push(...r[o.name].options.map(e=>"string"==typeof e?{value:e,label:e}:{value:e.value,label:e.label}))),c})({type:"value",path:r},l,o,d,u,(e.value??"").toString(),_),[r,l,o,d,u,e.value,_]),F=(0,n.useMemo)(()=>M.find(e=>e.isCustom&&e.customOption),[M]);(0,n.useEffect)(()=>{!a||c||M.length>0&&M.every(e=>e.isCustom)&&!k&&R(!0)},[a,c,M,k]);let $=(0,n.useCallback)(t=>{"Backspace"===t.key&&""===e.operator&&(t.preventDefault(),y(r),v({type:"group",path:r.slice(0,-1)}))},[e.operator,v,r,y]),{highlightedIndex:Q,handleKeyDown:B,reset:z}=tA(O.length,e=>{O[e]&&j(O[e])},$),{highlightedIndex:q,handleKeyDown:U,reset:V}=tA(M.length,e=>{let t=M[e];t&&(t.isCustom?R(!0):j(t))},b);(0,n.useEffect)(()=>{s||z()},[s,z]),(0,n.useEffect)(()=>{a||V()},[a,V]);let W=(0,n.useCallback)(e=>{D(!0),p(r,e.target.value)},[p,r]),H=(0,n.useCallback)(e=>{P(!0),h(r,e.target.value)},[h,r]),K=(0,n.useCallback)(()=>{y(r)},[y,r]);return T?(0,t.jsxs)("div",{ref:N,className:(0,Z.cn)("flex items-stretch px-0 bg-muted group shrink-0","pill"===w?"rounded border":"border-r",i&&"ring-2 ring-primary"),children:[(0,t.jsx)("span",{className:"text-xs pl-2 pr-1 cursor-pointer shrink-0 whitespace-nowrap text-foreground-light h-full flex items-center",onClick:()=>g(r),children:T.label}),(0,t.jsxs)(eG.Popover_Shadcn_,{open:s&&!c&&O.length>0,children:[(0,t.jsx)(t$.PopoverAnchor,{asChild:!0,children:(0,t.jsxs)("div",{className:"relative inline-block",children:[(0,t.jsx)(tF.Input_Shadcn_,{ref:S,type:"text",value:e.operator,onChange:W,onFocus:()=>m(r),onBlur:I,onKeyDown:B,className:"h-full border-none bg-transparent py-0 px-1 text-center text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 text-brand w-full absolute left-0 top-0",disabled:c,"aria-label":`Operator for ${T.label}`}),(0,t.jsx)("span",{className:"invisible whitespace-pre text-xs block px-1 shrink-0 px-1",children:e.operator||" "})]})}),(0,t.jsx)(eH.PopoverContent_Shadcn_,{className:"min-w-[220px] p-0",align:"start",side:"bottom",onOpenAutoFocus:e=>e.preventDefault(),onCloseAutoFocus:e=>e.preventDefault(),onInteractOutside:e=>{let t=e.target;N.current&&!N.current.contains(t)&&f()},children:(0,t.jsx)(tV,{items:O,highlightedIndex:Q,onSelect:j,includeIcon:!1})})]}),(0,t.jsxs)(eG.Popover_Shadcn_,{open:a&&!c&&(k||M.length>0),children:[(0,t.jsx)(t$.PopoverAnchor,{asChild:!0,children:(0,t.jsxs)("div",{className:"relative inline-block max-w-[150px]",children:[(0,t.jsx)(tF.Input_Shadcn_,{ref:C,type:"text",value:(e.value??"").toString(),onChange:H,onFocus:()=>x(r),onBlur:L,onKeyDown:U,className:"h-full border-none bg-transparent py-0 px-1 text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 w-full absolute left-0 top-0",disabled:c,"aria-label":`Value for ${T.label}`}),(0,t.jsx)("span",{className:"invisible whitespace-pre text-xs block px-1",children:(e.value??"").toString()||" "})]})}),(0,t.jsx)(eH.PopoverContent_Shadcn_,{className:"min-w-[220px] w-fit p-0",align:"start",side:"bottom",onOpenAutoFocus:e=>e.preventDefault(),onCloseAutoFocus:e=>e.preventDefault(),onInteractOutside:e=>{let t=e.target;N.current&&!N.current.contains(t)&&f()},children:k&&F&&F.customOption?F.customOption({onChange:e=>{h(r,e),R(!1),setTimeout(()=>{v({type:"group",path:r.slice(0,-1)})},0)},onCancel:()=>{R(!1),K()},search:(e.value??"").toString()}):(0,t.jsx)(tV,{items:M,highlightedIndex:q,onSelect:e=>e.isCustom?R(!0):j(e),includeIcon:!0})})]}),(0,t.jsx)(A.Button,{type:"text",size:"tiny",icon:(0,t.jsx)(tW.X,{strokeWidth:1,size:10,className:"group-hover:text-foreground text-foreground-lighter"}),onClick:K,className:"group hover:text-foreground hover:!bg-surface-600 rounded-none px-1 h-auto py-0","aria-label":`Remove ${T.label} filter`,tabIndex:-1})]}):null}function tK({group:e,path:r}){let{filterProperties:a,activeInput:s,freeformText:i,isLoading:l,supportsOperators:o,actions:c,variant:d,highlightedConditionPath:u,handleInputBlur:p,handleGroupFreeformFocus:h,handleGroupFreeformChange:m,handleLogicalOperatorChange:x,handleKeyDown:f,handleSelectMenuItem:g}=tO(),[b,y]=(0,n.useState)(""),j=(0,n.useRef)(null),v=(0,n.useRef)(null),[w,S]=(0,n.useState)(!1),C=s?.type==="group"&&tT(r,s.path);(0,n.useEffect)(()=>{""===i&&y("")},[i]),(0,n.useEffect)(()=>{C&&j.current&&j.current.focus()},[C]);let N=tI(v,p),T=e=>{y(e.target.value),m(r,e.target.value)},k=()=>{x(r)},R=(0,n.useMemo)(()=>(function(e){let{filterProperties:t,inputValue:n,supportsOperators:r,actions:a}=e,s=[];s.push(...t.filter(e=>e.label.toLowerCase().includes(n.toLowerCase())).map(e=>({value:e.name,label:e.label}))),r&&s.push({value:"group",label:"New Group"});let i=n.trim();return a&&i.length>0&&a.forEach(e=>{s.push({value:e.value,label:e.label,icon:e.icon,isAction:!0,action:e,actionInputValue:i})}),s})({filterProperties:a,inputValue:(C?i:b)||"",actions:c,supportsOperators:o}),[a,C,i,b,c,o]),E=0===r.length,{highlightedIndex:D,handleKeyDown:_,reset:P}=tA(R.length,e=>{R[e]&&g(R[e])},f,{skipEnterWhenFilterHighlighted:null!==u});return(0,n.useEffect)(()=>{C||P()},[C,P]),(0,t.jsx)("div",{ref:v,className:`flex items-stretch gap-0 shrink-0 ${r.length>0?"before:content-['('] before:text-foreground-muted after:content-[')'] after:text-foreground-muted":""} ${E?"flex-1 min-w-0":""} ${"pill"===d?"py-2":""}`,children:(0,t.jsxs)("div",{className:(0,Z.cn)("flex items-stretch",E?"flex-1 min-w-0":"","pill"===d?"gap-1":"gap-0"),children:[e.conditions.map((a,i)=>{let l=[...r,i];return(0,t.jsxs)(n.default.Fragment,{children:[i>0&&o&&(0,t.jsx)("span",{className:`text-xs font-medium cursor-pointer ${w?"bg-surface-400 text-foreground dark:bg-surface-400":"text-foreground-muted"}`,onClick:k,onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),children:e.logicalOperator}),"logicalOperator"in a?(0,t.jsx)(tK,{group:a,path:l}):(0,t.jsx)(tH,{condition:a,path:l,isActive:!!s&&"value"===s.type&&tT(l,s.path),isOperatorActive:!!s&&"operator"===s.type&&tT(l,s.path),isHighlighted:!!u&&tT(l,u)})]},i)}),(0,t.jsxs)(eG.Popover_Shadcn_,{open:C&&!l&&R.length>0&&!u,children:[(0,t.jsx)(t$.PopoverAnchor,{asChild:!0,children:E?(0,t.jsx)(tF.Input_Shadcn_,{ref:j,type:"text",value:C?i:b,onChange:T,onFocus:()=>h(r),onBlur:N,onKeyDown:_,className:"border-none bg-transparent text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 w-full flex-1 h-auto min-w-0 px-2 py-0",placeholder:0===e.conditions.length?"Ask AI for help (e.g. Find all users with name John) or filter...":"Add more filters...",disabled:l}):(0,t.jsxs)("div",{className:"relative inline-block",children:[(0,t.jsx)(tF.Input_Shadcn_,{ref:j,type:"text",value:C?i:b,onChange:T,onFocus:()=>h(r),onBlur:N,onKeyDown:_,className:"h-full border-none bg-transparent py-0 text-xs focus:outline-none focus:ring-0 focus:shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 w-full absolute left-0 top-0 px-2",placeholder:"+ Add filter",disabled:l}),(0,t.jsx)("span",{className:"invisible whitespace-pre text-xs block",children:(C?i:b)||"+"})]})}),(0,t.jsx)(eH.PopoverContent_Shadcn_,{className:"min-w-[220px] p-0",align:"start",side:"bottom",onOpenAutoFocus:e=>e.preventDefault(),onCloseAutoFocus:e=>e.preventDefault(),onInteractOutside:e=>{let t=e.target;v.current&&!v.current.contains(t)&&p()},children:(0,t.jsx)(tV,{items:R,highlightedIndex:D,onSelect:g,includeIcon:!0})})]})]})})}function tG({className:e}){let{filters:n,error:r,optionsError:a,isLoading:s,variant:i,icon:l}=tO();return(0,t.jsxs)("div",{className:"w-full space-y-2 relative",children:[(0,t.jsxs)("div",{className:(0,Z.cn)("relative flex items-stretch gap-0 w-full border rounded-md h-full bg-foreground/[.026] cursor-text p-0 pr-2 overflow-auto",e),children:[(0,t.jsxs)("div",{className:(0,Z.cn)("relative flex items-center justify-center shrink-0 px-2 bg-surface-200","pill"===i?"bg-transparent border-r-0":"border-r"),children:[(0,t.jsx)("div",{className:(0,Z.cn)("transition-opacity duration-300 ease-in-out",l?"opacity-0":"opacity-100"),children:(0,t.jsx)(tC.Search,{className:"text-foreground-muted w-4 h-4 sticky"})}),l&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:l})]}),(0,t.jsx)(tS.motion.div,{className:"flex-1 flex flex-wrap items-stretch gap-0",animate:{opacity:s?.5:1},transition:{duration:1,repeat:s?1/0:0,repeatType:"reverse",ease:"easeInOut"},children:(0,t.jsx)(tK,{group:n,path:[]})})]}),(r||a)&&(0,t.jsx)("div",{className:"text-red-500 text-xs mt-1",children:r||a})]})}function tY({filterProperties:e,filters:n,onFilterChange:r,freeformText:a,onFreeformTextChange:s,actions:i,isLoading:l,className:o,supportsOperators:c=!1,variant:d="default",icon:u}){return(0,t.jsx)(tM,{filterProperties:e,filters:n,onFilterChange:r,freeformText:a,onFreeformTextChange:s,actions:i,isLoading:l,supportsOperators:c,variant:d,icon:u,children:(0,t.jsx)(tG,{className:o})})}tY.Root=tM,tY.Content=tG,tY.Group=tK;var tJ=e.i(585673);let tX=e.i(198512).FilterOperatorOptions.map(e=>({value:e.value,label:e.label})),tZ=[{value:"~~*",label:"ilike operator"},...tX.filter(e=>"~~*"!==e.value)],t0=[{value:">",label:"greater than"},{value:">=",label:"greater than or equal"},{value:"<",label:"less than"},{value:"<=",label:"less than or equal"},{value:"=",label:"equals"},{value:"<>",label:"not equal"}],t1=[{value:"=",label:"equals"},{value:"<>",label:"not equal"}];function t2({onChange:e,onCancel:r,search:a}){let[s,i]=(0,n.useState)(a?new Date(a):void 0);return(0,t.jsxs)("div",{className:"w-[300px] space-y-4",children:[(0,t.jsx)(tw.Calendar,{autoFocus:!0,mode:"single",defaultMonth:s,selected:s,onSelect:i,className:"w-full"}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 py-3 px-4 border-t",children:[(0,t.jsx)(A.Button,{type:"default",onClick:r,children:"Cancel"}),(0,t.jsx)(A.Button,{type:"primary",onClick:()=>e(s?(0,tv.format)(s,"yyyy-MM-dd"):""),children:"Apply"})]})]})}let t5=e=>{if("string"==typeof e)return e;if("object"!=typeof e||null===e)return null;let t="value"in e?e.value:void 0,n="label"in e?e.label:void 0,r="string"==typeof n;return"string"==typeof t&&r?t||n:r?n:null},t4=({isRefetching:e=!1})=>{let{filters:r,setFilters:a}=U(),s=(0,b.useTableEditorTableStateSnapshot)(),[i,l]=(0,n.useState)(""),{mutateAsync:o,isPending:c}=(({onSuccess:e,onError:t,...n}={})=>(0,tg.useMutation)({mutationFn:e=>tj(e),async onSuccess(t,n,r){await e?.(t,n,r)},async onError(e,n,r){void 0===t?ec.toast.error(`Failed to generate filters: ${e.message}`):t(e,n,r)},...n}))(),d=(0,n.useMemo)(()=>({logicalOperator:"AND",conditions:r.filter(e=>"string"==typeof e.column).map(e=>({propertyName:e.column,operator:e.operator,value:e.value}))}),[r]),u=(0,n.useMemo)(()=>s.table?.columns??[],[s.table?.columns]),p=(0,n.useMemo)(()=>u.map(e=>{let n=function(e){if((0,tJ.isEnumColumn)(e.dataType)&&e.enum)return{label:e.name,name:e.name,type:"string",options:e.enum.map(e=>({label:e,value:e})),operators:tX};if((0,tJ.isBoolColumn)(e.dataType))return{label:e.name,name:e.name,type:"boolean",options:[{label:"true",value:"true"},{label:"false",value:"false"}],operators:t1};if((0,tJ.isDateColumn)(e.format)||(0,tJ.isDateTimeColumn)(e.format)||(0,tJ.isTimeColumn)(e.format)){let t=new Date,n=new Date(Date.now()-864e5),r=new Date(Date.now()-6048e5),a=new Date(Date.now()-2592e6);return{label:e.name,name:e.name,type:"date",options:[{label:"Today",value:(0,tv.format)(t,"yyyy-MM-dd")},{label:"Yesterday",value:(0,tv.format)(n,"yyyy-MM-dd")},{label:"Last 7 days",value:(0,tv.format)(r,"yyyy-MM-dd")},{label:"Last 30 days",value:(0,tv.format)(a,"yyyy-MM-dd")}],operators:t0}}return{label:e.name,name:e.name,type:"string",operators:tZ}}(e);return"date"===n.type&&Array.isArray(n.options)?{...n,options:[...n.options,{label:"Pick a date...",component:e=>(0,t.jsx)(t2,{...e})}]}:n}),[u]),h=(0,n.useMemo)(()=>p.map(e=>({label:e.label,name:e.name,type:e.type,operators:e.operators,options:Array.isArray(e.options)?e.options.map(t5).filter(e=>!!e):void 0})),[p]),m=(0,n.useCallback)(e=>{a(function e(t){let n=[];for(let r of t.conditions)tN(r)?n.push(...e(r)):n.push({column:r.propertyName,operator:r.operator,value:String(r.value??"")});return n}(e))},[a]),x=(0,n.useMemo)(()=>[{value:"ai-filter",label:"Filter by AI",onSelect:async(e,t)=>{let n=e.trim();if(!n)return;let r=await o({prompt:n,filterProperties:h,currentPath:t.path??[]});m(function e(t,n,r){if(0===n.length)return r;let[a,...s]=n;return{...t,conditions:t.conditions.map((t,n)=>n===a?e(t,s,r):t)}}(t.activeFilters,t.path??[],r)),l("")}}],[o,h,m,l]),f=e?(0,t.jsx)(D.Loader2,{className:"animate-spin text-brand h-4 w-4 shrink-0","aria-label":"Loading table data"}):null;return(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)(tY,{filterProperties:p,filters:d,onFilterChange:m,freeformText:i,onFreeformTextChange:l,actions:x,isLoading:c,variant:"pill",className:"bg-transparent border-0",icon:f})})},t3=({customHeader:e,isRefetching:r,tableQueriesEnabled:a=!0})=>{!function(){let e=(0,b.useTableEditorTableStateSnapshot)(),{filters:t}=(0,tx.useTableEditorFiltersSort)(),r=(0,tf.useStaticEffectEvent)(()=>{let n=(0,V.formatFilterURLParams)(t);n.length>0&&e.setFilters(n)});(0,n.useEffect)(()=>{r()},[r])}(),function(){let e=(0,b.useTableEditorTableStateSnapshot)(),{setParams:t}=(0,tx.useTableEditorFiltersSort)(),r=(0,n.useRef)(null),a=(0,n.useRef)("");(0,n.useEffect)(()=>{let n=JSON.stringify(e.filters);if(n!==a.current)return a.current=n,r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{let n=e.filters.filter(e=>{let t=e.value;return""!==t&&null!=t}),r=(0,V.filtersToUrlParams)(n);t(e=>({...e,filter:r}))},500),()=>{r.current&&clearTimeout(r.current)}},[e.filters,t])}();let s=(0,b.useTableEditorTableStateSnapshot)(),i=0===s.selectedRows.size;return(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex h-10 items-center justify-between bg-dash-sidebar dark:bg-surface-100 px-1.5 py-1.5 gap-2 overflow-x-auto ",children:[e||(s.selectedRows.size>0?(0,t.jsx)(t7,{tableQueriesEnabled:a}):(0,t.jsx)(t6,{tableQueriesEnabled:a,isRefetching:r})),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(e6,{table:s.originalTable,isRefetching:r}),i&&(0,t.jsx)(t8,{})]})]})})},t6=({tableQueriesEnabled:e=!0,isRefetching:n})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex-1 min-w-0 flex items-center gap-2",children:(0,t.jsx)(t4,{isRefetching:n})}),(0,t.jsx)(tu,{tableQueriesEnabled:e})]}),t8=()=>{let{ref:e}=(0,r.useParams)(),{data:n}=(0,Y.useSelectedOrganizationQuery)(),s=(0,b.useTableEditorTableStateSnapshot)(),i=(0,g.useTableEditorStateSnapshot)(),{can:l}=(0,eq.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"columns"),{mutate:o}=(0,G.useSendEventMutation)(),c=s.editable&&(s.table.columns??[]).length>0?i.onAddRow:void 0,d=s.editable?i.onAddColumn:void 0,u=s.editable?i.onImportData:void 0;return(void 0!==c||void 0!==d)&&l?(0,t.jsxs)(tn.DropdownMenu,{children:[(0,t.jsx)(tn.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(A.Button,{"data-testid":"table-editor-insert-new-row",type:"primary",size:"tiny",icon:(0,t.jsx)(e9.ChevronDown,{strokeWidth:1.5}),children:"Insert"})}),(0,t.jsx)(tn.DropdownMenuContent,{side:"bottom",align:"end",children:[...void 0!==c?[(0,t.jsxs)(tn.DropdownMenuItem,{className:"group space-x-2",onClick:c,children:[(0,t.jsxs)("div",{className:"-mt-2 pr-1.5",children:[(0,t.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px]"}),(0,t.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px] my-[2px]"}),(0,t.jsx)("div",{className:(0,Z.cn)(["border border-foreground-light w-[15px] h-[4px] translate-x-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-x-0"])})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"Insert row"}),(0,t.jsxs)("p",{className:"text-foreground-light",children:["Insert a new row into ",s.table.name]})]})]},"add-row")]:[],...void 0!==d?[(0,t.jsxs)(tn.DropdownMenuItem,{className:"group space-x-2",onClick:d,children:[(0,t.jsxs)("div",{className:"flex -mt-2 pr-1.5",children:[(0,t.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px]"}),(0,t.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px] mx-[2px]"}),(0,t.jsx)("div",{className:(0,Z.cn)(["border border-foreground-light w-[4px] h-[15px] -translate-y-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-y-0"])})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"Insert column"}),(0,t.jsxs)("p",{className:"text-foreground-light",children:["Insert a new column into ",s.table.name]})]})]},"add-column")]:[],...void 0!==u?[(0,t.jsxs)(tn.DropdownMenuItem,{className:"group space-x-2",onClick:()=>{u(),o({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:e??"Unknown",organization:n?.slug??"Unknown"}})},children:[(0,t.jsxs)("div",{className:"relative -mt-2",children:[(0,t.jsx)(te.FileText,{size:18,strokeWidth:1.5,className:"-translate-x-[2px]"}),(0,t.jsx)(e7.ArrowUp,{className:(0,Z.cn)("transition duration-200 absolute bottom-0 right-0 translate-y-1 opacity-0 bg-brand-400 rounded-full","group-data-[highlighted]:translate-y-0 group-data-[highlighted]:text-brand group-data-[highlighted]:opacity-100"),strokeWidth:3,size:12})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:"Import data from CSV"}),(0,t.jsx)("p",{className:"text-foreground-light",children:"Insert new rows from a CSV"})]})]},"import-data")]:[]]})]}):null},t7=({tableQueriesEnabled:e=!0})=>{let r=(0,o.useQueryClient)(),{data:a}=(0,u.useSelectedProjectQuery)(),s=(0,g.useTableEditorStateSnapshot)(),i=(0,b.useTableEditorTableStateSnapshot)(),c=(0,y.useIsQueueOperationsEnabled)(),p=(0,f.useRoleImpersonationStateSnapshot)(),h=void 0!==p.role,m=i.filters,{sorts:x}=(0,P.useTableSort)(),[j,v]=(0,n.useState)(!1),[w,S]=(0,n.useState)(!1),{data:C}=(0,d.useTableRowsQuery)({projectRef:a?.ref,connectionString:a?.connectionString,tableId:i.table.id,sorts:x,filters:m,page:i.page,limit:s.rowsPerPage,roleImpersonationState:p},{enabled:e}),{data:N}=(0,I.useTableRowsCountQuery)({projectRef:a?.ref,connectionString:a?.connectionString,tableId:i.table.id,filters:m,enforceExactCount:i.enforceExactCount,roleImpersonationState:p},{placeholderData:l.keepPreviousData,enabled:e}),T=C?.rows??[],k=N?.count??0,R=e=>{let t=T.filter(e=>i.selectedRows.has(e.idx));if("csv"===e){let e=tl({rows:t,columns:i.table.columns.map(e=>e.name)});(0,ta.copyToClipboard)(e)}else if("sql"===e){let e=(0,eL.formatTableRowsToSQL)(i.table,t);(0,ta.copyToClipboard)(e)}else"json"===e&&(0,ta.copyToClipboard)(JSON.stringify(t));ec.toast.success("Copied rows to clipboard")},E=i.allRowsSelected?{type:"fetch_all",filters:m,sorts:x}:{type:"provided_rows",table:i.table,rows:T.filter(e=>i.selectedRows.has(e.idx))},{exportCsv:D,confirmationModal:_}=(0,e8.useExportAllRowsAsCsv)(a?{enabled:!0,projectRef:a.ref,connectionString:a?.connectionString??null,entity:i.table,totalRows:k,...E}:{enabled:!1}),L=async()=>{if(v(!0),!a)return ec.toast.error("Project is required"),v(!1);D(),v(!1)},{exportSql:O,confirmationModal:M}=(0,e8.useExportAllRowsAsSql)(a?{enabled:!0,projectRef:a.ref,connectionString:a?.connectionString??null,entity:i.table,...E}:{enabled:!1}),F=async()=>{if(v(!0),!a)return ec.toast.error("Project is required"),v(!1);O(),v(!1)},{exportJson:$,confirmationModal:Q}=(0,e8.useExportAllRowsAsJson)(a?{enabled:!0,projectRef:a.ref,connectionString:a?.connectionString??null,entity:i.table,...E}:{enabled:!1}),B=async()=>{if(!a)return ec.toast.error("Project is required");v(!0),$(),v(!1)};return(0,f.useSubscribeToImpersonatedRole)(()=>{(i.allRowsSelected||i.selectedRows.size>0)&&i.resetSelectedRows()}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[i.editable&&(0,t.jsx)(eM.ButtonTooltip,{type:"default",size:"tiny",icon:(0,t.jsx)(tt.Trash,{}),onClick:()=>{let e=Array.from(i.selectedRows),t=T.filter(t=>e.includes(t.idx));if(c&&!i.allRowsSelected){(0,er.queueRowDeletesWithOptimisticUpdate)({rows:t,table:i.originalTable,queryClient:r,queueOperation:s.queueOperation,projectRef:a?.ref}),i.resetSelectedRows();return}let n=i.allRowsSelected?k:i.selectedRows.size;s.onDeleteRows(t,{allRowsSelected:i.allRowsSelected,numRows:n,callback:()=>{i.resetSelectedRows()}})},disabled:i.allRowsSelected&&h,tooltip:{content:{side:"bottom",text:i.allRowsSelected&&h?"Table truncation is not supported when impersonating a role":void 0}},children:i.allRowsSelected?"Delete all rows in table":i.selectedRows.size>1?`Delete ${i.selectedRows.size} rows`:`Delete ${i.selectedRows.size} row`}),i.allRowsSelected?(0,t.jsx)(eM.ButtonTooltip,{disabled:!0,type:"default",tooltip:{content:{side:"bottom",className:"w-64 text-center",text:"Copy to clipboard is not supported while all rows in the table are selected"}},children:"Copy"}):(0,t.jsxs)(tn.DropdownMenu,{children:[(0,t.jsx)(tn.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"default",size:"tiny",iconRight:(0,t.jsx)(e9.ChevronDown,{}),loading:j,disabled:j,children:"Copy"})}),(0,t.jsxs)(tn.DropdownMenuContent,{align:"start",className:"w-40",children:[(0,t.jsx)(tn.DropdownMenuItem,{onClick:()=>R("csv"),children:"Copy as CSV"}),(0,t.jsx)(tn.DropdownMenuItem,{onClick:()=>R("sql"),children:"Copy as SQL"}),(0,t.jsx)(tn.DropdownMenuItem,{onClick:()=>R("json"),children:"Copy as JSON"})]})]}),(0,t.jsxs)(tn.DropdownMenu,{children:[(0,t.jsx)(tn.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(A.Button,{type:"default",size:"tiny",iconRight:(0,t.jsx)(e9.ChevronDown,{}),loading:j,disabled:j,children:"Export"})}),(0,t.jsxs)(tn.DropdownMenuContent,{align:"start",className:i.allRowsSelected?"w-52":"w-40",children:[(0,t.jsx)(tn.DropdownMenuItem,{onClick:L,children:"Export as CSV"}),(0,t.jsx)(tn.DropdownMenuItem,{onClick:F,children:"Export as SQL"}),i.allRowsSelected?(0,t.jsx)(tn.DropdownMenuItem,{className:"group",onClick:()=>S(!0),children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"group-hover:text-foreground",children:"Export via CLI"}),(0,t.jsx)("p",{className:"text-foreground-lighter",children:"Recommended for large tables"})]})}):(0,t.jsx)(tn.DropdownMenuItem,{onClick:B,children:"Export as JSON"})]})]}),!i.allRowsSelected&&k>T.length&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-6 ml-0.5",children:(0,t.jsx)(tr.Separator,{orientation:"vertical"})}),(0,t.jsx)(A.Button,{type:"text",onClick:()=>void i.setSelectedRows(new Set(T.map(e=>e.idx)),!0),children:"Select all rows in table"})]})]}),(0,t.jsx)(ts.ExportDialog,{table:i.table,filters:m,sorts:x,open:w,onOpenChange:()=>S(!1)}),_,M,Q]})};var t9=e.i(816467),ne=e.i(53071),nt=e.i(607764);let nn=({rows:e})=>{let r=(0,o.useQueryClient)(),{data:a}=(0,u.useSelectedProjectQuery)(),s=(0,g.useTableEditorStateSnapshot)(),i=(0,b.useTableEditorTableStateSnapshot)(),l=(0,y.useIsQueueOperationsEnabled)(),c=(0,n.useCallback)(t=>{let n=t.props?.rowIdx;if(!i.selectedCellPosition||null==n)return;let r=e[n][i.gridColumns[i.selectedCellPosition.idx].key],a=(0,nt.formatClipboardValue)(r);(0,ta.copyToClipboard)(a),ec.toast.success("Copied cell value to clipboard")},[e,i.gridColumns,i.selectedCellPosition]),d=(0,n.useCallback)(t=>{let n=t.props?.rowIdx;if(null==n)return;let r=e[n];(0,ta.copyToClipboard)(JSON.stringify(r)),ec.toast.success("Copied row to clipboard")},[e]);return(0,t.jsxs)(ew.Menu,{id:eS.ROW_CONTEXT_MENU_ID,animation:!1,className:"!min-w-36",children:[(0,t.jsxs)(ew.Item,{onClick:c,children:[(0,t.jsx)(t9.Copy,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Copy cell"})]}),(0,t.jsxs)(ew.Item,{onClick:d,children:[(0,t.jsx)(t9.Copy,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Copy row"})]}),i.editable&&(0,t.jsx)(eh.DialogSectionSeparator,{className:"my-1.5"}),(0,t.jsxs)(ew.Item,{onClick:function(t){let n=t.props?.rowIdx;if(null==n)return;let r=e[n];s.onEditRow(r)},hidden:!i.editable,data:"edit",children:[(0,t.jsx)(ne.Edit,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Edit row"})]}),i.editable&&(0,t.jsx)(eh.DialogSectionSeparator,{className:"my-1.5"}),(0,t.jsxs)(ew.Item,{onClick:function(t){let n=t.props?.rowIdx;if(null==n)return;let o=e[n];o?l?(0,er.queueRowDeletesWithOptimisticUpdate)({rows:[o],table:i.originalTable,queryClient:r,queueOperation:s.queueOperation,projectRef:a?.ref}):s.onDeleteRows([o]):ec.toast.error("Row not found")},hidden:!i.editable,data:"delete",children:[(0,t.jsx)(tt.Trash,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Delete row"})]})]})},nr=({title:e,children:n})=>(0,t.jsx)("div",{className:"mt-2 px-3 pb-2",children:(0,t.jsx)(ep.Admonition,{type:"warning",title:e,description:n})}),na=()=>(0,t.jsx)(nr,{title:"Cannot sort by filtered column",children:'Sorting only by columns filtered with "=" or "is" doesn\'t work on MSSQL tables. Pick a different sorting column, or add a column not in your filter.'}),ns=()=>(0,t.jsx)(nr,{title:"No valid sort column remaining",children:'All columns that can be sorted have been filtered with "=" or "is", which doesn\'t work on MSSQL tables. Remove a column from your filter to continue.'}),ni=({customHeader:e,gridProps:a,children:s})=>{let{id:i}=(0,r.useParams)(),j=i?Number(i):void 0,w=(0,y.useIsQueueOperationsEnabled)(),S=(0,o.useQueryClient)(),{data:C}=(0,u.useSelectedProjectQuery)(),N=(0,g.useTableEditorStateSnapshot)(),T=(0,b.useTableEditorTableStateSnapshot)(),k=(0,n.useRef)(null),[R,E]=(0,n.useState)(!1),D=(0,y.useIsTableFilterBarEnabled)(),{filters:I}=(0,_.useTableFilter)(),{sorts:A,onApplySorts:L}=(0,P.useTableSort)(),O=(0,f.useRoleImpersonationStateSnapshot)(),M=(0,c.isMsSqlForeignTable)(T.originalTable)?(({filters:e,sorts:t,table:n})=>{if(!(0,c.isMsSqlForeignTable)(n))return{warning:null};let r=new Set(e.filter(e=>"="===e.operator||"is"===e.operator).map(e=>e.column)),a=t.length>0&&t.every(e=>r.has(e.column));if(r.size>0&&a)return{warning:"ConflictingSort",Component:na};let s=n.columns.length>0&&n.columns.every(e=>"json"===e.data_type||r.has(e.name));return e.length>0&&s?{warning:"NoValidSortPossible",Component:ns}:{warning:null}})({filters:I,sorts:A,table:T.originalTable}):{warning:null},F=null===M.warning,{data:$,error:Q,isSuccess:B,isError:z,isPending:U,isRefetching:V,dataUpdatedAt:W}=(0,d.useTableRowsQuery)({projectRef:C?.ref,connectionString:C?.connectionString,tableId:j,sorts:A,filters:I,page:T.page,limit:N.rowsPerPage,roleImpersonationState:O},{placeholderData:l.keepPreviousData,enabled:F,retry:(e,t)=>(t&&t.message?.includes("does not exist")&&L([]),!1)});(0,n.useEffect)(()=>{R||E(!0)},[]);let H="saving"===N.operationQueue.status;(0,n.useEffect)(()=>{B&&C?.ref&&j&&w&&N.hasPendingOperations&&!H&&(0,er.reapplyOptimisticUpdates)({queryClient:S,projectRef:C.ref,tableId:j,operations:N.operationQueue.operations})},[B,W,C?.ref,j,w,N.hasPendingOperations,N.operationQueue.operations,S,H]);let K=$?.rows??p.EMPTY_ARR;return(0,t.jsx)(h.DndProvider,{backend:m.HTML5Backend,context:window,children:(0,t.jsxs)("div",{className:"sb-grid h-full flex flex-col",children:[(0,t.jsx)(D?t3:tp,{customHeader:e,isRefetching:V,tableQueriesEnabled:F}),null!==M.warning&&(0,t.jsx)(M.Component,{}),s||(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eT,{ref:k,...a,rows:K,error:Q,isDisabled:!F,isLoading:U,isSuccess:B,isError:z}),(0,t.jsx)(q,{enableForeignRowsQuery:F}),(0,t.jsx)(v,{gridRef:k,rows:K})]}),R&&(0,x.createPortal)((0,t.jsx)(nn,{rows:K}),document.body)]})})};var nl=e.i(990510),no=e.i(983783),nc=e.i(238944),nd=e.i(63519),nu=e.i(290623),np=e.i(565066),nh=e.i(156054),nm=e.i(896975),nx=e.i(487164),nf=e.i(887093),ng=e.i(48189);let nb=({entity:e})=>{let{ref:a}=(0,r.useParams)(),i=(0,n.useRef)(null),l=(0,n.useRef)(null),{resolvedTheme:o}=(0,nm.useTheme)(),{data:d}=(0,u.useSelectedProjectQuery)(),p=e0({id:e?.id,projectRef:d?.ref,connectionString:d?.connectionString},{enabled:(0,c.isViewLike)(e)}),h=(0,nx.useTableDefinitionQuery)({id:e?.id,projectRef:d?.ref,connectionString:d?.connectionString},{enabled:(0,c.isTableLike)(e)}),{data:m,isLoading:x}=(0,c.isViewLike)(e)?p:h,f=(0,c.isView)(e)?`create view ${e.schema}.${e.name} as
`:(0,c.isMaterializedView)(e)?`create materialized view ${e.schema}.${e.name} as
`:"",g=(0,n.useMemo)(()=>m?(0,nf.formatSql)(f+m):void 0,[m]),b=async(e,t)=>{i.current=e,l.current=t,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,ng.timeout)(500),e?.focus()};return x?(0,t.jsxs)("div",{className:"h-full grid",children:[(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(ee.GenericSkeletonLoader,{})}),(0,t.jsx)("div",{className:"mt-auto",children:(0,t.jsx)(q,{})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,t.jsx)(A.Button,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10",children:(0,t.jsx)(s.default,{href:`/project/${a}/sql/new?content=${encodeURIComponent(g??"")}`,children:"Open in SQL Editor"})}),(0,t.jsx)(nh.default,{className:"monaco-editor",theme:o?.includes("dark")?"vs-dark":"vs",onMount:b,defaultLanguage:"pgsql",value:g,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0}})]}),(0,t.jsx)(q,{})]})},ny=({isLoadingSelectedTable:e=!1,selectedTable:l})=>{let o=(0,i.useRouter)(),{ref:d,id:u}=(0,r.useParams)(),{setLastVisitedTable:p}=(0,nl.useDashboardHistory)(),{selectedSchema:h}=(0,no.useQuerySchemaState)(),m=(0,nd.useTabsStateSnapshot)();(0,V.useSyncTableEditorStateFromLocalStorageWithUrl)({projectRef:d,table:l});let[{view:x="data"}]=(0,nc.useUrlState)(),{can:f}=(0,eq.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"tables"),{can:g}=(0,eq.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"columns"),y=u?m.openTabs.find(e=>e.endsWith(u)):void 0,j=m.openTabs.filter(e=>!e.startsWith("sql")),v=(0,n.useCallback)(e=>{o.push(`/project/${d}/editor/${e.id}${h?`?schema=${h}`:""}`)},[d,o]),w=(0,n.useCallback)(async()=>{if(l){let e=(0,nd.createTabId)(l.entity_type,{id:l.id});m.handleTabClose({id:e,router:o,editor:"table",onClearDashboardHistory:()=>p(void 0)})}},[o,l,m]),{isSchemaLocked:S}=(0,eV.useIsProtectedSchema)({schema:l?.schema??""});if(e||!d)return(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"h-10 bg-dash-sidebar dark:bg-surface-100"}),(0,t.jsx)("div",{className:"h-9 border-y"}),(0,t.jsx)("div",{className:"p-2 col-span-full",children:(0,t.jsx)(ee.GenericSkeletonLoader,{})})]});let C=(0,c.isView)(l)||(0,c.isMaterializedView)(l),N=(0,c.isTableLike)(l),T=(0,c.isForeignTable)(l),k=!(!f&&!g)&&N&&!S,R=l?`${l.schema}_${l.name}`:"unknown-table";return(0,t.jsxs)("div",{className:"h-full",onClick:()=>m.makeActiveTabPermanent(),children:[l?(0,t.jsxs)(b.TableEditorTableStateContextProvider,{projectRef:d,table:l,editable:k,children:[(0,t.jsx)(ni,{gridProps:{height:"100%"},customHeader:(C||N)&&"definition"===x?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("p",{children:["SQL Definition of ",(0,t.jsx)("code",{className:"text-sm",children:l.name})," "]}),(0,t.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,children:(C||N)&&"definition"===x&&(0,t.jsx)(nb,{entity:l})},R),(0,t.jsx)(nu.default,{selectedTable:N?l:void 0,onTableDeleted:w})]},`table-editor-table-${l.id}`):(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"w-[400px]",children:(0,t.jsx)(ep.Admonition,{type:"default",title:`Unable to find your table with ID ${u}`,description:"This table doesn't exist in your database",children:y?(0,t.jsx)(A.Button,{type:"default",className:"mt-2",onClick:()=>{m.handleTabClose({id:y,router:o,editor:"table",onClearDashboardHistory:()=>p(void 0)})},children:"Close tab"}):j.length>0?(0,t.jsx)(A.Button,{asChild:!0,type:"default",className:"mt-2",onClick:()=>p(void 0),children:(0,t.jsx)(s.default,{href:`/project/${d}/editor/${j[0].split("-")[1]}`,children:"Close tab"})}):(0,t.jsx)(A.Button,{asChild:!0,type:"default",className:"mt-2",onClick:()=>p(void 0),children:(0,t.jsx)(s.default,{href:`/project/${d}/editor`,children:"Head back"})})})})}),(0,t.jsx)(np.SidePanelEditor,{editable:k,selectedTable:N||T?l:void 0,onTableCreated:v})]})};var nj=e.i(448710),nv=e.i(569715),nw=e.i(111331),nS=e.i(207831);let nC=()=>{let{id:e,ref:a}=(0,r.useParams)(),s=e?Number(e):void 0,i=(0,nd.useTabsStateSnapshot)(),{data:l}=(0,u.useSelectedProjectQuery)(),{data:o,isPending:c}=(0,N.useTableEditorQuery)({projectRef:l?.ref,connectionString:l?.connectionString,id:s});return(0,n.useEffect)(()=>{if(o&&a){let e=(0,nd.createTabId)(o.entity_type,{id:o.id});i.tabsMap[e]?i.makeTabActive(e):i.addTab({id:e,type:o.entity_type,label:o.name,metadata:{schema:o.schema,name:o.name,tableId:s}})}},[o,s,a]),(0,t.jsx)(ny,{isLoadingSelectedTable:c,selectedTable:o})};nC.getLayout=e=>(0,t.jsx)(nj.DefaultLayout,{children:(0,t.jsx)(nv.EditorBaseLayout,{productMenu:(0,t.jsx)(nS.TableEditorMenu,{}),product:"Table Editor",productMenuClassName:"overflow-y-hidden",children:(0,t.jsx)(nw.TableEditorLayout,{children:e})})}),e.s(["default",0,nC],561912)},935074,(e,t,n)=>{let r="/project/[ref]/editor/[id]";(window.__NEXT_P=window.__NEXT_P||[]).push([r,()=>e.r(561912)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([r])})}]);

//# debugId=fca9db0f-0664-fa92-7af7-bf1906685481
//# sourceMappingURL=f854a81a6aa90ed7.js.map